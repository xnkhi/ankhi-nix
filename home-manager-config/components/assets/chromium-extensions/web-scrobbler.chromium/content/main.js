(function(){"use strict";const Me=[{label:"YouTube",matches:["*://www.youtube.com/*","*://m.youtube.com/*"],js:"youtube.js",id:"youtube",usesBlocklist:!0},{label:"MySpace",matches:["*://myspace.com/*"],js:"myspace.js",id:"myspace"},{label:"Bandcamp Daily",matches:["*://daily.bandcamp.com/*"],js:"bandcamp-embed.js",id:"bandcamp-embed",allFrames:!0},{label:"Bandcamp",matches:["*://*.bandcamp.com/*","*://bandcamp.com/*"],js:"bandcamp.js",id:"bandcamp"},{label:"BNDCMPR",matches:["*://bndcmpr.co/*"],js:"bndcmpr.js",id:"bndcmpr",allFrames:!0},{label:"Buy Music Club",matches:["*://www.buymusic.club/*"],js:"buymusicclub.js",id:"buymusicclub"},{label:"Pandora",matches:["*://www.pandora.com/*"],js:"pandora.js",id:"pandora"},{label:"Pakartot",matches:["*://www.pakartot.lt/*"],js:"pakartot.js",id:"pakartot"},{label:"Deezer",matches:["*://www.deezer.com/*"],js:"deezer.js",id:"deezer"},{label:"SoundCloud",matches:["*://soundcloud.com/*","*://m.soundcloud.com/*"],js:"soundcloud.js",id:"soundcloud"},{label:"Amazon Music",matches:["*://music.amazon.*/*","*://www.amazon.*/gp/dmusic/cloudplayer/*"],js:"amazon.js",id:"amazon"},{label:"Amazon Echo",matches:["*://alexa.amazon.*/spa/*"],js:"amazon-alexa.js",id:"amazon-alexa"},{label:"Radio Vas3k Club",matches:["https://radio.vas3k.club/*"],js:"vas3kradio.js",id:"vas3kradio"},{label:"VK",matches:["*://vk.ru/*","*://vk.com/*"],js:"vk.js",id:"vk"},{label:"Megalyrics",matches:["*://megalyrics.ru/*"],js:"megalyrics.js",id:"megalyrics"},{label:"iHeartRadio",matches:["*://*.iheart.com/*"],js:"iheart.js",id:"iheart"},{label:"Indie Shuffle",matches:["*://www.indieshuffle.com/*"],js:"indieshuffle.js",id:"indieshuffle"},{label:"Tuba.FM",matches:["*://fm.tuba.pl/*"],js:"tubafm.js",id:"tubafm"},{label:"Spotify",matches:["*://open.spotify.com/*"],js:"spotify.js",id:"spotify",hasNativeScrobbler:!0},{label:"plug.dj",matches:["*://plug.dj/*"],js:"plug.dj.js",id:"plug.dj"},{label:"Dandelion Radio",matches:["*://www.dandelionradio.com/player.htm"],js:"dandelionradio.js",id:"dandelionradio"},{label:"HillyDilly",matches:["*://www.hillydilly.com/*"],js:"hillydilly.js",id:"hillydilly"},{label:"8tracks",matches:["*://8tracks.com/*"],js:"8tracks.js",id:"8tracks"},{label:"SoGreatandPowerful",matches:["*://sogreatandpowerful.com/*"],js:"sogreatandpowerful.js",id:"sogreatandpowerful"},{label:"Radio Cidade",matches:["*://radiocidade.fm/player/*","*://play.radiomania.com.br/*","*://*.melodia.com.br/*","*://jb.fm/player/*"],js:"radiocidade.js",id:"radiocidade"},{label:"Radio Nova",matches:["*://www.nova.fr/*"],js:"nova.js",id:"nova"},{label:"Radioplus",matches:["*://www.radioplus.be/*","*://radioplus.be/*"],js:"radioplus.js",id:"radioplus"},{label:"Радио Premium",matches:["*://rpfm.ru/*"],js:"rpfm.js",id:"rpfm"},{label:"Douban.FM",matches:["*://douban.fm/*","*://fm.douban.fm/*"],js:"douban.fm.js",id:"douban.fm"},{label:"Focus@Will",matches:["*://www.focusatwill.com/*"],js:"focusatwill.js",id:"focusatwill"},{label:"Subphonic (owncloud plugin)",matches:["*://*/*/apps/subphonic/minisub/*"],js:"subphonic.js",id:"subphonic"},{label:"Digitally Imported",matches:["*://www.di.fm/*"],js:"radiotunes.js",id:"di"},{label:"BBC Sounds",matches:["*://*.bbc.co.uk/*"],js:"bbc-sounds.js",id:"bbc-sounds"},{label:"Gaana",matches:["*://gaana.com/*"],js:"gaana.js",id:"gaana"},{label:"Яндекс.Музыка",matches:["*://music.yandex.ru/*","*://music.yandex.by/*","*://music.yandex.kz/*","*://music.yandex.ua/*","*://music.yandex.com/*"],js:"yandex-music.js",id:"yandex-music"},{label:"Plex",matches:["*://*32400/web/*","*://plex.tv/web/*","*://*.plex.tv/web/*","*://*.plex.tv/desktop*"],js:"plex.js",id:"plex"},{label:"TuneIn",matches:["*://tunein.com/*"],js:"tunein.js",id:"tunein"},{label:"Mixcloud",matches:["*://mixcloud.com/*","*://*.mixcloud.com/*"],js:"mixcloud.js",id:"mixcloud"},{label:"ReverbNation",matches:["*://www.reverbnation.com/*"],js:"reverbnation.js",id:"reverbnation"},{label:"NRK Radio",matches:["*://radio.nrk.no/*"],js:"nrk-radio.js",id:"nrk-radio"},{label:"Internet Archive",matches:["*://archive.org/details/*"],js:"archive.js",id:"archive"},{label:"Odnoklassniki",matches:["*://odnoklassniki.ru/*","*://ok.ru/*"],js:"odnoklassniki.js",id:"odnoklassniki"},{label:"Overcast",matches:["*://overcast.fm/*"],js:"overcast.js",id:"overcast"},{label:"Online Radio Box",matches:["*://onlineradiobox.com/*","*://p.onlineradiobox.com/*"],js:"onlineradiobox.js",id:"onlineradiobox"},{label:"163 Music",matches:["*://music.163.com/*"],js:"163-music.js",id:"163-music"},{label:"Ambient Sleeping Pill",matches:["*://ambientsleepingpill.com/"],js:"ambientsleepingpill.js",id:"ambientsleepingpill"},{label:"a.m. ambient",matches:["*://amambient.com/"],js:"ambientsleepingpill.js",id:"amambient"},{label:"Tidal",matches:["*://tidal.com/*"],js:"tidal.js",id:"tidal"},{label:"Hype Machine Featured Albums",matches:["*://hypem.com/album/*"],js:"hypem-albums.js",id:"hypem-premieres"},{label:"Hype Machine",matches:["*://hypem.com/*"],js:"hypem.js",id:"hypem"},{label:"Radionomy",matches:["*://www.radionomy.com/*"],js:"radionomy.js",id:"radionomy"},{label:"J1 Radio",matches:["*://www.j1fm.tokyo/player/*","*://www.j1fm.tokyo/michi/player/*"],js:"aiircom.js",id:"j1-radio"},{label:"JazzAndRain",matches:["*://*.jazzandrain.com/*"],js:"jazzandrain.js",id:"jazzandrain"},{label:"RelaxingBeats",matches:["*://*.relaxingbeats.com/*"],js:"jazzandrain.js",id:"relaxingbeats"},{label:"EpicMusicTime",matches:["*://*.epicmusictime.com/*"],js:"jazzandrain.js",id:"epicmusictime"},{label:"AccuJazz",matches:["*://www.accuradio.com/pop_player/accujazz/*"],js:"accujazz.js",id:"accujazz"},{label:"AccuRadio",matches:["*://www.accuradio.com/*"],js:"accuradio.js",id:"accuradio"},{label:"Imusic.am",matches:["*://imusic.am/*"],js:"imusic.am.js",id:"imusic.am"},{label:"Earbits",matches:["*://www.earbits.com/*"],js:"earbits.js",id:"earbits"},{label:"Player.fm",matches:["*://player.fm/*"],js:"player.fm.js",id:"player.fm"},{label:"Sound Test",matches:["*://sndtst.com/*"],js:"sndtst.js",id:"sndtst"},{label:"RadioTunes",matches:["*://www.radiotunes.com/*"],js:"radiotunes.js",id:"radiotunes"},{label:"RockRadio",matches:["*://www.rockradio.com/*"],js:"radiotunes.js",id:"rockradio"},{label:"ClassicalRadio",matches:["*://www.classicalradio.com/*"],js:"radiotunes.js",id:"classicalradio"},{label:"Audacy",matches:["*://www.audacy.com/*"],js:"audacy.js",id:"audacy"},{label:"Audius",matches:["*://audius.co/*"],js:"audius.js",id:"audius"},{label:"GetWorkDoneMusic",matches:["*://*.getworkdonemusic.com/*"],js:"getworkdonemusic.js",id:"getworkdonemusic"},{label:"Jamendo",matches:["*://www.jamendo.com/*"],js:"jamendo.js",id:"jamendo"},{label:"Bandzone.cz",matches:["*://bandzone.cz/*"],js:"bandzone.cz.js",id:"bandzone.cz"},{label:"Music Player for Google Drive",matches:["*://www.driveplayer.com/*"],js:"driveplayer.js",id:"driveplayer"},{label:"Kodi",js:"kodi.js",id:"kodi"},{label:"Superplayer",matches:["*://www.superplayer.fm/*"],js:"superplayer.js",id:"superplayer"},{label:"RMFON",matches:["*://www.rmfon.pl/*"],js:"rmfon.js",id:"rmfon"},{label:"Radio 357",matches:["*://radio357.pl/*"],js:"radio357.js",id:"radio357"},{label:"JazzRadio",matches:["*://www.jazzradio.com/*"],js:"radiotunes.js",id:"jazzradio"},{label:"Zen Radio",matches:["*://www.zenradio.com/*"],js:"radiotunes.js",id:"zenradio"},{label:"SomaFM",matches:["*://somafm.com/player/*","*://somafm.com/player24/*"],js:"somafm.js",id:"somafm"},{label:"Free Music Archive",matches:["*://*.freemusicarchive.org/*"],js:"freemusicarchive.js",id:"freemusicarchive"},{label:"Reddit Music Player",matches:["*://reddit.musicplayer.io/"],js:"redditmusicplayer.js",id:"redditmusicplayer"},{label:"Новое Радио",matches:["*://www.novoeradio.by/*"],js:"novoeradio.js",id:"novoeradio"},{label:"Radio Paradise",matches:["*://radioparadise.com/*"],js:"radioparadise.js",id:"radioparadise",allFrames:!0},{label:"Beatport",matches:["*://www.beatport.com/*"],js:"beatport.js",id:"beatport"},{label:"Beeline Music",matches:["*://music.beeline.ru/*"],js:"beeline-music.js",id:"beeline-music"},{label:"wavo",matches:["*://wavo.me/*"],js:"wavo.js",id:"wavo"},{label:"FluxFM Berlin",matches:["*://www.fluxfm.de/*"],js:"fluxfm.js",id:"fluxfm"},{label:"Noise FM",matches:["*://noisefm.ru/*","*://en.noisefm.ru/*"],js:"noisefm.js",id:"noisefm",allFrames:!0},{label:"WWOZ",matches:["*://www.wwoz.org/listen/player/*"],js:"wwoz.js",id:"wwoz"},{label:"Sonerezh",matches:["*://sonerezh.*/*","*://*/*sonerezh*"],js:"sonerezh.js",id:"sonerezh"},{label:"Youradio",matches:["*://www.youradio.cz/*"],js:"youradio.js",id:"youradio"},{label:"GPMusic",matches:["*://player.gpmusic.co/*"],js:"gpmusic.js",id:"gpmusic"},{label:"Nightwave Plaza",matches:["*://plaza.one/*"],js:"plaza.js",id:"plaza"},{label:"Retrowave",matches:["*://retrowave.ru/*"],js:"retrowave.js",id:"retrowave"},{label:"Genie",matches:["*://www.genie.co.kr/player/fPlayer*"],js:"genie.js",id:"genie"},{label:"Bugs",matches:["*://music.bugs.co.kr/newPlayer*"],js:"bugs.js",id:"bugs"},{label:"openfm",matches:["*://open.fm/*"],js:"openfm.js",id:"openfm"},{label:"Playmoss",matches:["*://playmoss.com/*"],js:"playmoss.js",id:"playmoss"},{label:"Apidog",matches:["*://apidog.ru/*"],js:"apidog.js",id:"apidog"},{label:"Pinguin Radio",matches:["*://pinguinradio.com/*"],js:"pinguinradio.js",id:"pinguinradio"},{label:"JioSaavn",matches:["*://www.jiosaavn.com/*"],js:"jiosaavn.js",id:"jiosaavn"},{label:"Anghami",matches:["*://*.anghami.com/*"],js:"anghami.js",id:"anghami"},{label:"Mail.ru Music",matches:["*://my.mail.ru/music","*://my.mail.ru/music/*"],js:"mail.ru.js",id:"mail.ru"},{label:"Emby/Jellyfin",matches:["*://*8096/web/*","*://*8920/web/*","*://app.emby.media/*"],js:"emby.js",id:"emby"},{label:"Freegal Music",matches:["*://*.freegalmusic.com/*"],js:"freegalmusic.js",id:"freegalmusic"},{label:"hoopla",matches:["*://www.hoopladigital.com/*"],js:"hoopladigital.js",id:"hoopladigital"},{label:"Amplify 817",matches:["*://amplify817.org/*"],js:"musicat.js",id:"amplify817"},{label:"Capital City Records",matches:["*://capitalcityrecords.ca/*"],js:"musicat.js",id:"capitalcityrecords"},{label:"Electric Lady Bird",matches:["*://atxlibrary.musicat.co/*"],js:"musicat.js",id:"musicat-atxlibrary"},{label:"FlipSide",matches:["*://flipside.apl.org/*"],js:"musicat.js",id:"apl-flipside"},{label:"HUM (Hear Utah Music)",matches:["*://hum.slcpl.org/*"],js:"musicat.js",id:"slcpl-hum"},{label:"KDL Vibes",matches:["*://vibes.kdl.org/*"],js:"musicat.js",id:"kdl-vibes"},{label:"Library Music Project",matches:["*://librarymusicproject.com/*"],js:"musicat.js",id:"librarymusicproject"},{label:"MNspin",matches:["*://hclib.musicat.co/*"],js:"musicat.js",id:"musicat-hclib"},{label:"Nashville BoomBox",matches:["*://boombox.library.nashville.org/*"],js:"musicat.js",id:"nashville-library-boombox"},{label:"QC Beats",matches:["*://qcbeats.org/*"],js:"musicat.js",id:"qcbeats"},{label:"Q-Dance",matches:["*://www.q-dance.com/*"],js:"q-dance.js",id:"q-dance"},{label:"Sawdust City Sounds",matches:["*://sawdustcitysounds.org/*"],js:"musicat.js",id:"sawdustcitysounds"},{label:"Seattle PlayBack",matches:["*://playback.spl.org/*"],js:"musicat.js",id:"spl-playback"},{label:"STACKS",matches:["*://stacks.carnegielibrary.org/*"],js:"musicat.js",id:"carnegielibrary-stacks"},{label:"Tracks Music Library",matches:["*://tracksmusiclibrary.org/*"],js:"musicat.js",id:"tracksmusiclibrary"},{label:"Monstercat",matches:["*://www.monstercat.com/*"],js:"monstercat.js",id:"monstercat"},{label:"Listen.moe",matches:["*://listen.moe/*"],js:"listen.moe.js",id:"listen.moe"},{label:"anime(bits)",matches:["*://radio.animebits.moe/","*://radio.animebits.moe/player/*"],js:"animebits.js",id:"animebits"},{label:"Fair Price Music",matches:["*://www.fairpricemusic.com/*"],js:"fairpricemusic.js",id:"fairpricemusic"},{label:"Radio ULTRA",matches:["*://player.radioultra.ru/*"],js:"radioultra.js",id:"radioultra"},{label:"Наше Радио",matches:["*://player.nashe.ru/*"],js:"radioultra.js",id:"nashe"},{label:"RockFM",matches:["*://player.rockfm.ru/*"],js:"radioultra.js",id:"rockfm"},{label:"Radio JAZZ",matches:["*://player.radiojazzfm.ru/*"],js:"radioultra.js",id:"radiojazzfm"},{label:"WO Streaming",matches:["*://*player.wostreaming.net/*"],js:"wostreaming.js",id:"wostreaming"},{label:"Listen Live",matches:["*://player.listenlive.co/*"],js:"listenlive.js",id:"listenlive"},{label:"Rayo",matches:["*://hellorayo.co.uk/*/play/*","*://hellorayo.co.uk/*/player/*"],js:"planetradio.js",id:"planetradio"},{label:"Roxx Radio",matches:["*://roxx.gr/radio/*"],js:"roxx.js",id:"roxx"},{label:"ListenOnRepeat",matches:["*://listenonrepeat.com/*"],js:"listenonrepeat.js",id:"listenonrepeat"},{label:"Duckburg Radio",matches:["*://*.radio-mb.com/*"],js:"radio-mb.js",id:"radio-mb"},{label:"Webradio.de",matches:["*://www.webradio.de/*"],js:"radioplayer.js",id:"webradio.de"},{label:"The Breeze",matches:["*://www.thebreeze.com/*/radioplayer/*"],js:"radioplayer.js",id:"thebreeze"},{label:"RadioPlayer",matches:["*://ukradioplayer.*/*","*://radioplayer.*/*","*://*/radioplayer/*","*://*/radio/player/","*://*/*/radio/player/"],js:"radioplayer.js",id:"radioplayer"},{label:"deltaradio",matches:["*://www.deltaradio.de/*"],js:"deltaradio.de.js",id:"deltaradio.de"},{label:"Radio Bob",matches:["*://*.radiobob.de/*"],js:"radiobob.js",id:"radiobob"},{label:"ByteFM",matches:["*://www.byte.fm/*"],js:"byte.fm.js",id:"byte.fm"},{label:"Deutschlandfunk Nova",matches:["*://www.deutschlandfunknova.de/*"],js:"deutschlandfunknova.js",id:"deutschlandfunknova"},{label:"QQ Music",matches:["*://y.qq.com/*"],js:"qq-music.js",id:"qq-music"},{label:"QQ Video",matches:["*://v.qq.com/x/*"],js:"qq-video.js",id:"qq-video"},{label:"Naver",matches:["*://playerui.music.naver.com/*"],js:"naver.js",id:"naver"},{label:"Soribada",matches:["*://www.soribada.com/*"],js:"soribada.js",id:"soribada"},{label:"Flo",matches:["*://www.music-flo.com/*"],js:"music-flo.js",id:"music-flo"},{label:"Discogs",matches:["*://www.discogs.com/*"],js:"youtube-embed.js",id:"youtube-embed",allFrames:!0},{label:"NPR",matches:["*://www.npr.org/*"],js:"npr.js",id:"npr"},{label:"Streamsquid",matches:["*://streamsquid.com/*"],js:"streamsquid.js",id:"streamsquid"},{label:"Streemlion",matches:["*://listen.streemlion.com/*"],js:"streemlion.js",id:"streemlion"},{label:"eMusic",matches:["*://www.emusic.com/*"],js:"emusic.js",id:"emusic"},{label:"LyricsTraining",matches:["*://lyricstraining.com/*"],js:"lyricstraining.js",id:"lyricstraining"},{label:"Music Walker",matches:["*://arkanath.com/MusicWalker/*"],js:"musicwalker.js",id:"musicwalker"},{label:"radioeins",matches:["*://www.radioeins.de/livestream/*"],js:"radioeins.js",id:"radioeins"},{label:"Fritz",matches:["*://www.fritz.de/livestream/*"],js:"fritz.js",id:"fritz"},{label:"Musicoin",matches:["*://musicoin.org/*"],js:"musicoin.js",id:"musicoin"},{label:"181.fm",matches:["*://player.181fm.com/*"],js:"181.fm.js",id:"181.fm"},{label:"Phish.in",matches:["*://phish.in/*"],js:"phish.in.js",id:"phish.in"},{label:"Rainwave",matches:["*://rainwave.cc/*","*://all.rainwave.cc/*","*://game.rainwave.cc/*","*://chiptune.rainwave.cc/*","*://ocr.rainwave.cc/*","*://covers.rainwave.cc/*"],js:"rainwave.js",id:"rainwave"},{label:"Retro Synthwave",matches:["*://www.retro-synthwave.com/*"],js:"retro-synthwave.js",id:"retro-synthwave"},{label:"Радиоволна.нет",matches:["*://radiovolna.net/*"],js:"radiovolna.js",id:"radiovolna"},{label:"Feedbands",matches:["*://feedbands.com/*"],js:"feedbands.js",id:"feedbands"},{label:"Taazi",matches:["*://taazi.com/*"],js:"taazi.js",id:"taazi"},{label:"Patari",matches:["*://patari.pk/*"],js:"patari.js",id:"patari"},{label:"pCloud",matches:["*://my.pcloud.com/*"],js:"pcloud.js",id:"pcloud"},{label:"JetSetRadio Live",matches:["*://jetsetradio.live/*"],js:"jetsetradio.live.js",id:"jetsetradio.live"},{label:"Radio France",matches:["*://www.radiofrance.fr/*"],js:"radiofrance.js",id:"radiofrance"},{label:"RemixRotation",matches:["*://remixrotation.com/*"],js:"remixrotation.js",id:"remixrotation"},{label:"WFMU",matches:["*://wfmu.org/*","*://freeform.wfmu.org/*"],js:"wfmu.js",id:"wfmu"},{label:"SiriusXM",matches:["*://www.siriusxm.com/*","*://www.siriusxm.ca/*","*://*.siriusxm.com/player/*"],js:"siriusxm-player.js",id:"siriusxm-player"},{label:"1ting",matches:["*://www.1ting.com/player/*","*://www.1ting.com/p_*","*://www.1ting.com/album*","*://www.1ting.com/rand.php*","*://www.1ting.com/day/*","*://h5.1ting.com/*"],js:"1ting.js",id:"1ting"},{label:"Douban Artists",matches:["*://music.douban.com/artists/player/*"],js:"douban-artists.js",id:"douban-artists"},{label:"Kugou",matches:["*://www.kugou.com/song/*"],js:"kugou.js",id:"kugou"},{label:"Gimme Radio",matches:["*://gimmeradio.com/*","*://www.gimmeradio.com/*","*://gimmecountry.com/*","*://www.gimmecountry.com/*","*://gimmemetal.com/*","*://www.gimmemetal.com/*"],js:"gimmeradio.js",id:"gimmeradio"},{label:"9sky",matches:["*://www.9sky.com/music*","*://www.9sky.com/mv/detail*"],js:"9sky.js",id:"9sky"},{label:"Vagalume.FM",matches:["*://vagalume.fm/*","*://*.vagalume.com.br/*"],js:"vagalume.js",id:"vagalume"},{label:"Radiooooo",matches:["*://radiooooo.com/*","*://mobile.radiooooo.com/*"],js:"radiooooo.js",id:"radiooooo"},{label:"LetsLoop",matches:["*://letsloop.com/*"],js:"letsloop.js",id:"letsloop"},{label:"Mideast Tunes",matches:["*://mideastunes.com/*","*://map.mideastunes.com/*"],js:"mideastunes.js",id:"mideastunes"},{label:"Český Rozhlas",matches:["*://prehravac.rozhlas.cz/*"],js:"rozhlas.js",id:"rozhlas"},{label:"blocSonic",matches:["*://*.blocsonic.com/*"],js:"blocsonic.js",id:"blocsonic"},{label:"Resonate",matches:["*://stream.resonate.coop/*"],js:"resonate.js",id:"resonate"},{label:"KEXP",matches:["*://*.kexp.org/*"],js:"kexp.js",id:"kexp"},{label:"Hotmixradio.fr",matches:["*://www.hotmixradio.fr/*"],js:"hotmixradio.js",id:"hotmixradio"},{label:"Aphex Twin",matches:["*://aphextwin.warp.net/*"],js:"warp-aphextwin.js",id:"warp-aphextwin"},{label:"Zachary Seguin Music",matches:["*://music.zacharyseguin.ca/*"],js:"musickit.js",id:"zacharyseguin"},{label:"Joox",matches:["*://www.joox.com/*"],js:"joox.js",id:"joox"},{label:"Musish",matches:["*://musi.sh/*"],js:"musickit.js",id:"musish"},{label:"1001tracklists",matches:["*://www.1001tracklists.com/tracklist/*"],js:"1001tracklists.js",id:"1001tracklists"},{label:"YouTube Music",matches:["*://music.youtube.com/*"],js:"youtube-music.js",id:"youtube-music"},{label:"Radiozenders.FM",matches:["*://www.radiozenders.fm/*"],js:"radiozenders.js",id:"radiozenders"},{label:"Invidious",matches:["*://*.invidio.us/*"],js:"invidious.js",id:"invidious"},{label:"Piped",matches:["*://piped.video/*"],js:"piped.js",id:"piped"},{label:"Pretzel",matches:["*://*.pretzel.rocks/*"],js:"pretzel.js",id:"pretzel"},{label:"Primordial Radio",matches:["*://primordialradio.com/*"],js:"primordialradio.js",id:"primordialradio"},{label:"Radio Kyivstar",matches:["*://radio.kyivstar.ua/*"],js:"kyivstar.js",id:"kyivstar"},{label:"Funkwhale",js:"funkwhale.js",id:"funkwhale"},{label:"9128.live",matches:["*://9128.live/*","*://embed.radio.co/player/*"],js:"radioco.js",id:"9128.live",allFrames:!0},{label:"Radio.co",matches:["*://embed.radio.co/player/*"],js:"radioco.js",id:"radioco"},{label:"Super45.fm",matches:["*://super45.fm/"],js:"radioco.js",id:"super45fm",allFrames:!0},{label:"R/a/dio",matches:["*://r-a-d.io/*"],js:"r-a-d.io.js",id:"r-a-d.io"},{label:"Apple Music",matches:["*://*music.apple.com/*"],js:"musickit.js",id:"apple-music"},{label:"Primephonic",matches:["*://play.primephonic.com/*"],js:"primephonic.js",id:"primephonic"},{label:"Watch2Gether",matches:["*://w2g.tv/*"],js:"watch2gether.js",id:"watch2gether"},{label:"Poolsuite",matches:["*://poolsuite.net/*"],js:"poolsuite.js",id:"poolsuite"},{label:"GDS.FM",matches:["*://www.gds.fm/*","*://gds.fm/*"],js:"gds.fm.js",id:"gds"},{label:"Wynk Music",matches:["*://wynk.in/music*"],js:"wynk.js",id:"wynk"},{label:"RadioJavan",matches:["*://play.radiojavan.com/*"],js:"radiojavan.js",id:"radiojavan"},{label:"Audiomack",matches:["*://audiomack.com/*"],js:"audiomack.js",id:"audiomack"},{label:"Global Player",matches:["*://www.globalplayer.com/*"],js:"globalplayer.js",id:"globalplayer"},{label:"The Current",matches:["*://www.thecurrent.org/*"],js:"thecurrent.js",id:"thecurrent"},{label:"pan y rosas discos",matches:["*://www.panyrosasdiscos.net/*"],js:"panyrosasdiscos.js",id:"panyrosasdiscos"},{label:"GRRIF",matches:["*://*.grrif.ch/*"],js:"grrif.js",id:"grrif"},{label:"newgrounds",matches:["*://www.newgrounds.com/audio*"],js:"newgrounds.js",id:"newgrounds"},{label:"Jango",matches:["*://www.jango.com/*"],js:"jango.js",id:"jango"},{label:"PlayIrish",matches:["*://*.playirish.ie/*"],js:"playirish.js",id:"playirish"},{label:"Radio Record",matches:["*://www.radiorecord.ru/*"],js:"radiorecord.js",id:"radiorecord"},{label:"Imago Radio",matches:["*://*.imago.fm/*"],js:"imago.js",id:"imago"},{label:"Provoda.ch",matches:["*://*.provoda.ch/*"],js:"provoda.ch.js",id:"provoda.ch"},{label:"Atomic Music Space",matches:["*://stream.atomicmusic.space/*"],js:"atomicmusic.space.js",id:"atomicmusic.space"},{label:"The-radio.ru",matches:["*://the-radio.ru/*"],js:"the-radio.ru.js",id:"the-radio.ru"},{label:"HQ Radio",matches:["*://hqradio.ru/*"],js:"hqradio.js",id:"hqradio"},{label:"Smooth FM",matches:["*://smoothfm.iol.pt/*"],js:"smoothfm.js",id:"smoothfm"},{label:"Vodafone.fm",matches:["*://vodafone.fm/*"],js:"vodafone.fm.js",id:"vodafonefm"},{label:"Relisten.net",matches:["*://relisten.net/*"],js:"relisten.js",id:"relisten"},{label:"UpBeatRadio",matches:["*://upbeatradio.net/*"],js:"upbeatradio.js",id:"upbeatradio"},{label:"Chillhop",matches:["*://chillhop.com/*"],js:"chillhop.js",id:"chillhop"},{label:"DatPiff",matches:["*://www.datpiff.com/player/*"],js:"datpiff.js",id:"datpiff",allFrames:!0},{label:"Shuffle",matches:["*://shuffle.one/play*"],js:"shuffleone.js",id:"shuffleone"},{label:"JB FM",matches:["*://jb.fm/player/*"],js:"jb.fm.js",id:"jbfm"},{label:"SECTOR Radio",matches:["*://sectorradio.ru/*"],js:"sectorradio.js",id:"sectorradio"},{label:"LiveOne",matches:["*://*.liveone.com/*"],js:"liveone.js",id:"liveone"},{label:"PocketCasts",matches:["*://play.pocketcasts.com/*"],js:"pocketcasts.js",id:"pocketcasts"},{label:"Clyp",matches:["*://clyp.it/*"],js:"clyp.js",id:"clyp"},{label:"RTBF Radio",matches:["*://www.rtbf.be/radio/*"],js:"rtbf.js",id:"rtbf"},{label:"TuneTrack",matches:["*://tunetrack.net/*"],js:"tunetrack.js",id:"tunetrack"},{label:"Musify",matches:["*://*.musify.club/*"],js:"musify.js",id:"musify"},{label:"Radio Rethink",matches:["*://www.radiorethink.com/*"],js:"radiorethink.js",id:"radiorethink"},{label:"SoundClick",matches:["*://www.soundclick.com/*"],js:"soundclick.js",id:"soundclick"},{label:"Napster",matches:["*://app.napster.com/*"],js:"napster.js",id:"napster"},{label:"abc.net.au",matches:["*://www.abc.net.au/*/listen-live/*"],js:"abc.net.au.js",id:"abcnetau"},{label:"JQBX",matches:["*://app.jqbx.fm/*"],js:"jqbx.js",id:"jqbx"},{label:"music.jsososo.com",matches:["*://y.jsososo.com/*","*://music.jsososo.com/*"],js:"jsososo.js",id:"jsososo"},{label:"Supla",matches:["*://*.supla.fi/*"],js:"supla.js",id:"supla"},{label:"swr3",matches:["*://www.swr3.de/*"],js:"swr3.js",id:"swr3"},{label:"Epidemic Sound",matches:["*://*.epidemicsound.com/*"],js:"epidemicsound.js",id:"epidemicsound"},{label:"Rekt Network",matches:["*://rekt.network/*"],js:"rekt.network.js",id:"rektnetwork"},{label:"Nightride FM",matches:["*://nightride.fm/*"],js:"nightride.fm.js",id:"nightridefm"},{label:"Qobuz",matches:["*://*.qobuz.com/*"],js:"qobuz.js",id:"qobuz"},{label:"TruckersFM",matches:["*://*.truckers.fm/*"],js:"truckersfm.js",id:"truckersfm"},{id:"winampify",label:"Winampify",js:"winampify.js",matches:["*://winampify.io/*"]},{label:"detektor.fm",matches:["*://detektor.fm/*"],js:"detektorfm.js",id:"detektorfm"},{label:"iBroadcast",matches:["*://media.ibroadcast.com/*"],js:"ibroadcast.js",id:"ibroadcast"},{label:"Radio7",matches:["*://radio7.lv/*"],js:"radio7.js",id:"radio7lv"},{label:"TOWER RECORDS MUSIC",matches:["*://music.tower.jp/*"],js:"towerrecordsmusic.js",id:"towerrecordsmusic"},{label:"Eggs",matches:["*://eggs.mu/*"],js:"eggs.js",id:"eggs"},{label:"Jamstash",matches:["*://jamstash.com/*"],js:"jamstash.js",id:"jamstash"},{label:"SubFire",matches:["*://p.subfireplayer.net/*"],js:"subfire.js",id:"subfire"},{label:"Idagio",matches:["*://app.idagio.com/*"],js:"idagio.js",id:"idagio"},{label:"Relax FM",matches:["*://relax-fm.ru/*"],js:"relaxfm.js",id:"relaxfm"},{label:"Laut.fm",matches:["*://laut.fm/*"],js:"laut.fm.js",id:"laut.fm"},{label:"Magnatune",matches:["*://magnatune.com/*"],js:"magnatune.js",id:"magnatune"},{label:"Libre.fm",matches:["*://libre.fm/*"],js:"librefm.js",id:"librefm"},{label:"Brain.fm",matches:["*://my.brain.fm/*"],js:"brainfm.js",id:"brainfm"},{label:"bullofheaven.com",matches:["*://bullofheaven.com/*"],js:"bullofheaven.com.js",id:"bullofheavencom"},{label:"All Classical Portland",matches:["*://player.allclassical.org/*"],js:"allclassical.org.js",id:"allclassicalportland"},{label:"Migu Music",matches:["*://music.migu.cn/*"],js:"migu-music.js",id:"migu-music"},{label:"Weibo",matches:["*://weibo.com/*","*://*.weibo.com/*"],js:"weibo.js",id:"weibo"},{label:"Street Voice",matches:["*://streetvoice.cn/*","*://streetvoice.com/*"],js:"streetvoice.js",id:"streetvoice"},{label:"Red Bull",matches:["*://www.redbull.com/*"],js:"redbull.js",id:"redbull"},{label:"Synology",matches:["*://*5000/*","*://*5001/*","*://*/?launchApp=SYNO.SDS.AudioStation.Application*"],js:"synology.js",id:"synology"},{label:"Ragya",matches:["*://www.ragya.com/*"],js:"ragya.js",id:"ragya"},{label:"CodeRadio",matches:["*://coderadio.freecodecamp.org/*"],js:"coderadio.js",id:"coderadio"},{label:"LITT Live",matches:["*://littlive.com/*"],js:"littlive.js",id:"dashradio"},{label:"Niconico",matches:["*://www.nicovideo.jp/*"],js:"nicovideo.js",id:"nicovideo"},{label:"Звук",matches:["*://zvuk.com/*"],js:"zvuk.js",id:"zvuk"},{label:"Navidrome",js:"navidrome.js",id:"navidrome"},{label:"LMS",js:"lms.js",id:"lms"},{label:"deep-cut.fm",matches:["*://deepcut.fm/*","*://turntable.fm/*","*://deep-cut.fm/*","*://deepcuts.fm/*"],js:"deep-cut.fm.js",id:"deepcut.fm"},{label:"Burntable",matches:["*://*.burntable.com/*"],js:"burntable.js",id:"burntable"},{label:"Stingray Music",matches:["*://*.stingray.com/*"],js:"stingray.js",id:"stingray"},{label:"CBC Music",matches:["*://www.cbc.ca/listen/cbc-music-playlists*"],js:"cbcmusic.js",id:"cbcmusic"},{label:"Indie88",matches:["*://indie88.com/lean-stream-player/*","*://cob.leanplayer.com/CINDFM*"],js:"indie88.js",id:"indie88"},{label:"Playlist Randomizer",matches:["*://www.playlist-randomizer.com/*","*://playlist-randomizer.com/*"],js:"playlist-randomizer.js",id:"playlist-randomizer"},{label:"QueUp",matches:["*://www.queup.net/*"],js:"queup.js",id:"queup"},{label:"Live 365",matches:["*://*.live365.com/*"],js:"live365.js",id:"live365"},{label:"Lounge.fm",matches:["*://www.lounge.fm/*"],js:"lounge.fm.js",id:"lounge.fm"},{label:"EulerBeats",matches:["*://eulerbeats.com/*"],js:"eulerbeats.js",id:"eulerbeats"},{label:"FilmMusic.io",matches:["*://*.filmmusic.io/*"],js:"filmmusic.io.js",id:"filmmusic.io"},{label:"X-Team Radio",matches:["*://radio.x-team.com/*"],js:"xteam-radio.js",id:"xteam-radio"},{label:"Calm",matches:["*://*.calm.com/*"],js:"calm.js",id:"calm"},{label:"Keakie",matches:["*://*.keakie.com/*"],js:"keakie.js",id:"keakie"},{label:"KKBOX",matches:["*://*play.kkbox.com/*"],js:"kkbox.js",id:"kkbox"},{label:"Thrill Jockey",matches:["*://thrilljockey.com/products/*"],js:"thrilljockey.js",id:"thrilljockey"},{label:"Radio Horizonte",matches:["*://horizonte.cl/*"],js:"mediastream.js",id:"horizontecl"},{label:"Sonar FM",matches:["*://sonarfm.cl/*"],js:"mediastream.js",id:"sonarfmcl"},{label:"Play FM",matches:["*://playfm.cl/*"],js:"mediastream.js",id:"playfmcl"},{label:"WKM Radio",matches:["*://www.wkmradio.com/*"],js:"mediastream.js",id:"wkmradio"},{label:"Rockaxis",matches:["*://www.rockaxis.com/*"],js:"mediastream.js",id:"rockaxis"},{label:"Rock&Pop Chile",matches:["*://www.rockandpop.cl/*"],js:"rockandpopcl.js",id:"rockandpopcl"},{label:"WYEP",matches:["*://wyep.org/*"],js:"wyep.js",id:"wyep"},{label:"ZENO",matches:["*://*zeno.fm/*"],js:"zeno.js",id:"zeno"},{label:"Naxos Music Library",matches:["*://*.naxosmusiclibrary.com/*"],js:"naxosmusiclibrary.js",id:"naxosmusiclibrary"},{label:"Klassik Radio",matches:["*://*klassikradio.de/*"],js:"klassikradio.de.js",id:"klassikradio"},{label:"Beetle",js:"beetle.js",id:"beetle"},{label:"RefNet",matches:["*://listen.refnet.fm/*"],js:"refnet.js",id:"refnet"},{label:"La Radio du bord de l'eau",matches:["*://*auborddeleau.radio/*"],js:"auborddeleau.radio.js",id:"auborddeleau.radio",allFrames:!0},{label:"Radio Willy",matches:["*://*willy.radio/player/willy/*"],js:"willy.radio.js",id:"willy.radio"},{label:"NIGHT.FM",matches:["*://*night.fm/*"],js:"night.fm.js",id:"night.fm"},{label:"Radio Nowy Swiat",matches:["*://nowyswiat.online/*"],js:"nowyswiat.js",id:"nowyswiat"},{label:"Radiolla",matches:["*://*radiolla.com/*"],js:"radiolla.js",id:"radiolla"},{label:"Oxigenio.fm",matches:["*://*oxigenio.fm/*"],js:"oxigenio.fm.js",id:"oxigenio.fm"},{label:"Intergalactic FM",matches:["*://*intergalactic.fm/*"],js:"intergalacticfm.js",id:"intergalactic.fm"},{label:"Radio Cuca",matches:["*://*radiocuca.es/*"],js:"radiocuca.js",id:"radiocuca"},{label:"Irama Nusantara",matches:["*://*.iramanusantara.org/*"],js:"iramanusantara.js",id:"iramanusantara"},{label:"Yammat FM",matches:["*://*yammat.fm/*"],js:"yammat.fm.js",id:"yammat.fm"},{label:"Husk Recordings",matches:["*://huskrecordings.com/music/*"],js:"huskrecordings.js",id:"huskrecordings"},{label:"nugs.net",matches:["*://play.nugs.net/*"],js:"nugs.js",id:"nugs"},{label:"livephish.com",matches:["*://plus.livephish.com/*"],js:"livephish.js",id:"livephish.com"},{label:"Ishkur's Guide to Electronic Music",matches:["*://music.ishkur.com/*"],js:"ishkur.js",id:"music.ishkur.com"},{label:"Nonoki",matches:["*://nonoki.com/music/*"],js:"nonoki.js",id:"nonoki"},{label:"Beatbump",matches:["*://beatbump.io/*"],js:"beatbump.js",id:"beatbump"},{label:"LINE MUSIC",matches:["*://music.line.me/*"],js:"line-music.js",id:"linemusic"},{label:"KCRW",matches:["*://www.kcrw.com/*"],js:"kcrw.js",id:"kcrw"},{label:"World Fusion Radio",matches:["*://worldfusionradio.com/*"],js:"worldfusionradio.js",id:"worldfusionradio"},{label:"Hardtunes",matches:["*://www.hard-tunes.de/*","*://www.hardtunes.com/*","*://www.hardtunes.fr/*","*://www.hardtunes.it/*","*://www.hardtunes.nl/*"],js:"hardtunes.js",id:"hardtunes"},{label:"KINK",matches:["*://kink.nl/player","*://kink.nl/player/*"],js:"kinknl.js",id:"kinknl"},{label:"The Jazz Groove",matches:["*://jazzgroove.org/*"],js:"jazzgroove.js",id:"jazzgroove"},{label:"XRAY.FM",matches:["*://*.xray.fm/*"],js:"xrayfm.js",id:"xrayfm"},{label:"DKFM Shoegaze Radio",matches:["*://decayfm.com/*"],js:"decayfm.js",id:"decayfm"},{label:"QCIndie",matches:["*://www.qcindie.com/listen-live/*"],js:"qcindie.js",id:"qcindie"},{label:"Colorado Public Radio",matches:["*://www.cpr.org/*"],js:"cpr.js",id:"cpr"},{label:"Indie 102.3",matches:["*://indie.cpr.org/"],js:"cpr-indie.js",id:"cpr-indie"},{label:"WXPN",matches:["*://xpn.org/*"],js:"xpn.js",id:"xpn"},{label:"FRISKY",matches:["*://*.frisky.fm/*"],js:"friskyfm.js",id:"friskyfm"},{label:"GotRadio",matches:["*://player.gotradio.com/*"],js:"gotradio.js",id:"gotradio"},{label:"LightningStream",matches:["*://*.lightningstream.com/Player*","*://*.lightningstream.com/player*"],js:"lightningstream.js",id:"lightningstream"},{label:"Securenet Systems",matches:["*://radio.securenetsystems.net/*","*://stream*.securenetsystems.net/*"],js:"securenetsystems.js",id:"securenetsystems"},{label:"WBRU",matches:["*://www.wbru.com/*"],js:"radioco.js",id:"wbru",allFrames:!0},{label:"uwu radio",matches:["*://radio.uwu.network/*"],js:"uwu-radio.js",id:"uwu-radio"},{label:"MyStreamPlayer",matches:["*://*.mystreamplayer.com/*"],js:"mystreamplayer.js",id:"mystreamplayer"},{label:"BagelRadio",matches:["*://*.bagelradio.com/*"],js:"mystreamplayer.js",id:"bagelradio",allFrames:!0},{label:"Amazing Radio",matches:["*://amazingradio.com/*","*://amazingradio.us/*"],js:"amazingradio.js",id:"amazingradio"},{label:"DR Lyd",matches:["*://www.dr.dk/lyd*"],js:"dr-lyd.js",id:"dr-lyd"},{label:"lulu.fm",matches:["*://*lulu.fm/*"],js:"lulu.fm.js",id:"lulufm"},{label:"ROCK ANTENNE",matches:["*://*rockantenne.*/webradio/*"],js:"rockantenne.js",id:"rockantenne"},{label:"copyparty",matches:["*://127.0.0.1:3923/*","*://a.ocv.me/*"],js:"copyparty.js",id:"copyparty"},{label:"Fungjai",matches:["*://*.fungjai.com/*"],js:"fungjai.js",id:"fungjai"},{label:"Radio Caprice",matches:["*://radcap.ru/*"],js:"radcap.js",id:"radcap"},{label:"TrackerHub",matches:["*://trackerhub.vercel.app/*","*://trackerhub.cx/*"],js:"trackerhub.js",id:"trackerhub"},{label:"Gensokyo Radio",matches:["*://gensokyoradio.net/*"],js:"gensokyoradio.js",id:"gensokyoradio"},{label:"Stationhead",matches:["*://*stationhead.com/*"],js:"stationhead.js",id:"stationhead"},{label:"TECHNOBASE.FM",matches:["*://*technobase.fm/*","*://*housetime.fm/*","*://*hardbase.fm/*","*://*trancebase.fm/*","*://*coretime.fm/*","*://*clubtime.fm/*","*://*teatime.fm/*","*://*replay.fm/*"],js:"technobase.fm.js",id:"technobase.fm"},{label:"Telegram A",matches:["*://web.telegram.org/a/*"],js:"telegram-a.js",id:"telegram-a"},{label:"Telegram K",matches:["*://web.telegram.org/k/*"],js:"telegram-k.js",id:"telegram-k"},{label:"TuneGenieEmbed",matches:["*://b3.tunegenie.com/*"],js:"tunegenie-embed.js",id:"tunegenie-embed",allFrames:!0},{label:"TuneGenie",matches:["*://*.tunegenie.com/*"],js:"tunegenie.js",id:"tunegenie"},{label:"RTL+ Musik",matches:["*://plus.rtl.de/*"],js:"rtl-plus-musik.js",id:"rtl-plus-musik"},{label:"Tomorrowland",matches:["*://www.tomorrowland.com/*"],js:"tomorrowland.js",id:"tomorrowland"},{label:"hearthis.at",matches:["*://hearthis.at/*"],js:"hearthis-at.js",id:"hearthis-at"},{label:"Blend",matches:["*://blend.io/*"],js:"blend.js",id:"blend"},{label:"Radio Italia",matches:["*://www.radioitalia.it/*"],js:"radio-italia.js",id:"radio-italia"},{label:"Lyden av Norge",matches:["*://www.lydenavnorge.no/*"],js:"lyden-av-norge.js",id:"lyden-av-norge"},{label:"audio.com",matches:["*://audio.com/*"],js:"audio.js",id:"audio-com"},{label:"AfroCharts",matches:["*://*.afrocharts.com/*"],js:"afrocharts.js",id:"afrocharts"},{label:"Ed Banger Records",matches:["*://*.edbangerrecords.com/*"],js:"ed-banger-records.js",id:"ed-banger-records"},{label:"Hyperpipe",matches:["*://hyperpipe.surge.sh/*"],js:"hyperpipe.js",id:"hyperpipe"},{label:"Radiofreccia",matches:["*://play.rtl.it/live/*"],js:"radiofreccia.js",id:"radiofreccia"},{label:"khinsider",matches:["*://downloads.khinsider.com/*"],js:"khinsider.js",id:"khinsider"},{label:"WDR",matches:["*://*.wdr.de/radio/*"],js:"wdr.js",id:"wdr"},{label:"radio.de",matches:["*://www.radio.de/*"],js:"radio.de.js",id:"radiode"},{label:"FMSpins",matches:["*://*.fmspins.com/*"],js:"fmspins.js",id:"fmspins"},{label:"vk-save",matches:["*://*.vk-save.com/*"],js:"vk-save.js",id:"vk-save"},{label:"Radio Student",matches:["*://www.radiostudent.hr/*"],js:"radiostudent.js",id:"radiostudent"},{label:"BiliBili",matches:["*://www.bilibili.com/*"],js:"bilibili.js",id:"bilibili",usesBlocklist:!0},{label:"jam.coop",matches:["*://jam.coop/*"],js:"jam.coop.js",id:"jam.coop"},{label:"Zing MP3",matches:["*://zingmp3.vn/*"],js:"zingmp3.js",id:"zingmp3"},{label:"NTS",matches:["*://*nts.live/*"],js:"nts.js",id:"nts"},{label:"earth.fm",matches:["*://earth.fm/*"],js:"earth.fm.js",id:"earthfm"},{label:"apt-get's auditorium",matches:["*://tunes.apt-get.xyz/*"],js:"apt-get-tunes.js",id:"apt-get-tunes"},{label:"AzuraCast",js:"azuracast.js",id:"azuracast"},{label:"scrobblerad.io",matches:["*://scrobblerad.io/*"],js:"scrobbleradio.js",id:"scrobbleradio"},{label:"weareone.fm",matches:["*://weareone.fm/*"],js:"weareone.js",id:"weareone"},{label:"Bollerwagen",matches:["*://radiobollerwagen.de/*"],js:"bollerwagen.js",id:"bollerwagen"},{label:"МТС Музыка",matches:["*://music.mts.ru/*"],js:"mts-music.js",id:"mts-music"},{label:"ChirpRadio",matches:["*://chirpradio.org/*"],js:"chirpradio.js",id:"chirpradio"},{label:"OnlyHit",matches:["*://onlyhit.us/*"],js:"onlyhit.js",id:"onlyhit"},{label:"InstantAudio",matches:["*://instant.audio/*","*://radiosdecuba.com/*","*://radio.ht/*","*://jamaicaradio.net/*","*://emisoras.com.mx/*","*://radiosdepuertorico.com/*","*://radios.com.do/*","*://trinidadradiostations.net/*","*://radios.co.cr/*","*://radios.com.sv/*","*://emisoras.com.gt/*","*://radios.hn/*","*://radios.co.ni/*","*://radios.com.pa/*","*://radioarg.com/*","*://radios.com.bo/*","*://radiosaovivo.net/*","*://emisora.cl/*","*://radios.com.co/*","*://radios.com.ec/*","*://emisoras.com.py/*","*://radios.com.pe/*","*://surinaamseradio.com/*","*://radios.com.uy/*","*://radio.co.ve/*","*://radiosonline.be/*","*://ceskaradiaonline.cz/*","*://radio.co.dk/*","*://radiolisten.de/*","*://raadiod.com/*","*://emisora.org.es/*","*://ecouterradioenligne.com/*","*://radiofona.com.gr/*","*://radios.hr/*","*://ieradio.org/*","*://ascoltareradio.com/*","*://latvijasradio.com/*","*://radios.lu/*","*://radijas.org/*","*://radiohallgatas.hu/*","*://nederlandseradio.nl/*","*://nettradionorge.com/*","*://radios.co.at/*","*://onlineradio.pl/*","*://radioonline.com.pt/*","*://radio.org.ro/*","*://radiosonline.ch/*","*://siradio.si/*","*://radiostanice.rs/*","*://nettiradiot.org/*","*://radio.org.se/*","*://internetradiouk.com/*","*://bg-radio.org/*","*://radio.pp.ru/*","*://radioua.net/*","*://radioalgerie.eu/*","*://radio.co.cm/*","*://radio.cd/*","*://radio.co.ci/*","*://radio.com.gh/*","*://radio.or.ke/*","*://radio.mg/*","*://radio.co.ma/*","*://egyptradio.net/*","*://radio.org.ng/*","*://radio.sn/*","*://radiosa.org/*","*://radiotunisienne.org/*","*://radio.co.ug/*","*://radio-bd.com/*","*://radioonline.kr/*","*://radios.hk/*","*://onlineradios.in/*","*://radioonline.co.id/*","*://radioonline.my/*","*://radionp.com/*","*://jpradio.jp/*","*://radio.net.pk/*","*://radio.org.ph/*","*://radiosingapore.org/*","*://radio.com.lk/*","*://vietnamradio.org/*","*://radios.org.il/*","*://radioth.net/*","*://zhibo.fm/*","*://radios.tw/*","*://radioau.net/*","*://radio.org.nz/*"],js:"instantaudio.js",id:"instantaudio"},{label:"Basspistol Radio",matches:["*://*.basspistol.com/*"],js:"basspistol.js",id:"basspistol"},{label:"RadioFreeFedi",matches:["*://radiofreefedi.net/*"],js:"radiofreefedi.js",id:"radiofreefedi"},{label:"MyTuner",matches:["*://mytuner-radio.com/*"],js:"mytuner.js",id:"mytuner"},{label:"Mirlo",matches:["*://mirlo.space/*"],js:"mirlo.js",id:"mirlo"},{label:"Simulator Radio",matches:["*://*.simulatorradio.com/*"],js:"simulatorradio.js",id:"simulatorradio"},{label:"Echo",matches:["*://echo.sleepyfran.me/*"],js:"echo.js",id:"echo"},{label:"Gizz Tapes",matches:["*://tapes.kglw.net/*"],js:"tapes-kglw.js",id:"tapes-kglw"},{label:"Systrum Sistum Radio",matches:["*://systrum.net/*"],js:"systrum.js",id:"systrum"},{label:"cosine.club",matches:["*://cosine.club/*"],js:"cosine.club.js",id:"cosine.club"},{label:"The Indie Beat Radio",matches:["*://theindiebeat.fm/*"],js:"theindiebeat.js",id:"theindiebeat"},{label:"Musique Approximative",matches:["*://*.musiqueapproximative.net/*"],js:"musiqueapproximative.js",id:"musiqueapproximative"},{label:"Suno AI",matches:["*://suno.com/*"],js:"suno.js",id:"suno"},{label:"[untitled]",matches:["*://untitled.stream/*"],js:"untitled.js",id:"[untitled]"},{label:"DAB Music Player",matches:["*://dab.yeet.su/*","*://dabmusic.xyz/*"],js:"dabmusic.js",id:"dabmusic"},{label:"GBS-FM",matches:["*://gbs.fm/*"],js:"gbs.fm.js",id:"gbs"},{label:"Yumi Co. Radio",matches:["*://yumicoradio.net/*"],js:"yumicoradio.js",id:"yumicoradio"},{label:"Kosmik Dstroyer",matches:["*://kosmik-dstroyer.top/*"],js:"kosmik-dstroyer.js",id:"kosmik-dstroyer"},{label:"LaTeX 4000",matches:["*://nonacademic.net/*"],js:"nonacademic.js",id:"nonacademic"},{label:"gravity.fm",matches:["*://gravity.fm/*"],js:"gravity.fm.js",id:"gravity"},{label:"Archaic Horizon",matches:["*://archaichorizon.com/*","*://www.archaichorizon.com/*"],js:"archaichorizon.js",id:"archaichorizon"},{label:"Aonsoku",matches:["*://aonsoku.vercel.app/*"],js:"aonsoku.js",id:"aonsoku"},{label:"CREAMER NATION",matches:["*://creamernation.men/*"],js:"creamernation.js",id:"creamer-nation"}];function ct(s){return s.replace(/[$()*+.?[\\^{|}]/g,"\\$&")}function ut(s){return s.split("*").map(ct).join(".*")}function Ms(s){if(typeof s!="string")return null;const e=/^(\*|https?):\/\/([^/]*)(\/.*)/.exec(s);if(!e)return null;const t=e[1],r=e[2],a=e[3];let i="^";if(t==="*"?i+="https?":i+=`${t}`,i+=ct("://"),r==="*")i+="[^\\/]+";else if(r){let n=r;r.startsWith("*.")&&(i+="([^\\/]+\\.|)",n=n.substr(2)),i+=ut(n)}else return null;return i+=ut(a),i+="$",new RegExp(i)}function _s(s,e){const t=Ms(e);return t?t.test(s):!1}function dt(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var de={exports:{}},Ds=de.exports,mt;function Fs(){return mt||(mt=1,(function(s,e){(function(t,r){r(s)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Ds,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const r="The message port closed before a response was received.",a=i=>{const n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(n).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class h extends WeakMap{constructor(o,b=void 0){super(b),this.createItem=o}get(o){return this.has(o)||this.set(o,this.createItem(o)),super.get(o)}}const y=u=>u&&typeof u=="object"&&typeof u.then=="function",A=(u,o)=>(...b)=>{i.runtime.lastError?u.reject(new Error(i.runtime.lastError.message)):o.singleCallbackArg||b.length<=1&&o.singleCallbackArg!==!1?u.resolve(b[0]):u.resolve(b)},k=u=>u==1?"argument":"arguments",O=(u,o)=>function(p,...j){if(j.length<o.minArgs)throw new Error(`Expected at least ${o.minArgs} ${k(o.minArgs)} for ${u}(), got ${j.length}`);if(j.length>o.maxArgs)throw new Error(`Expected at most ${o.maxArgs} ${k(o.maxArgs)} for ${u}(), got ${j.length}`);return new Promise((S,m)=>{if(o.fallbackToNoCallback)try{p[u](...j,A({resolve:S,reject:m},o))}catch(l){console.warn(`${u} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,l),p[u](...j),o.fallbackToNoCallback=!1,o.noCallback=!0,S()}else o.noCallback?(p[u](...j),S()):p[u](...j,A({resolve:S,reject:m},o))})},Ce=(u,o,b)=>new Proxy(o,{apply(p,j,S){return b.call(j,u,...S)}});let X=Function.call.bind(Object.prototype.hasOwnProperty);const V=(u,o={},b={})=>{let p=Object.create(null),j={has(m,l){return l in u||l in p},get(m,l,g){if(l in p)return p[l];if(!(l in u))return;let d=u[l];if(typeof d=="function")if(typeof o[l]=="function")d=Ce(u,u[l],o[l]);else if(X(b,l)){let ee=O(l,b[l]);d=Ce(u,u[l],ee)}else d=d.bind(u);else if(typeof d=="object"&&d!==null&&(X(o,l)||X(b,l)))d=V(d,o[l],b[l]);else if(X(b,"*"))d=V(d,o[l],b["*"]);else return Object.defineProperty(p,l,{configurable:!0,enumerable:!0,get(){return u[l]},set(ee){u[l]=ee}}),d;return p[l]=d,d},set(m,l,g,d){return l in p?p[l]=g:u[l]=g,!0},defineProperty(m,l,g){return Reflect.defineProperty(p,l,g)},deleteProperty(m,l){return Reflect.deleteProperty(p,l)}},S=Object.create(u);return new Proxy(S,j)},G=u=>({addListener(o,b,...p){o.addListener(u.get(b),...p)},hasListener(o,b){return o.hasListener(u.get(b))},removeListener(o,b){o.removeListener(u.get(b))}}),xe=new h(u=>typeof u!="function"?u:function(b){const p=V(b,{},{getContent:{minArgs:0,maxArgs:0}});u(p)}),Pe=new h(u=>typeof u!="function"?u:function(b,p,j){let S=!1,m,l=new Promise(ue=>{m=function(U){S=!0,ue(U)}}),g;try{g=u(b,p,m)}catch(ue){g=Promise.reject(ue)}const d=g!==!0&&y(g);if(g!==!0&&!d&&!S)return!1;const ee=ue=>{ue.then(U=>{j(U)},U=>{let lt;U&&(U instanceof Error||typeof U.message=="string")?lt=U.message:lt="An unexpected error occurred",j({__mozWebExtensionPolyfillReject__:!0,message:lt})}).catch(U=>{console.error("Failed to send onMessage rejected reply",U)})};return ee(d?g:l),!0}),Le=({reject:u,resolve:o},b)=>{i.runtime.lastError?i.runtime.lastError.message===r?o():u(new Error(i.runtime.lastError.message)):b&&b.__mozWebExtensionPolyfillReject__?u(new Error(b.message)):o(b)},Oe=(u,o,b,...p)=>{if(p.length<o.minArgs)throw new Error(`Expected at least ${o.minArgs} ${k(o.minArgs)} for ${u}(), got ${p.length}`);if(p.length>o.maxArgs)throw new Error(`Expected at most ${o.maxArgs} ${k(o.maxArgs)} for ${u}(), got ${p.length}`);return new Promise((j,S)=>{const m=Le.bind(null,{resolve:j,reject:S});p.push(m),b.sendMessage(...p)})},Ue={devtools:{network:{onRequestFinished:G(xe)}},runtime:{onMessage:G(Pe),onMessageExternal:G(Pe),sendMessage:Oe.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:Oe.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},c={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":c},services:{"*":c},websites:{"*":c}},V(i,Ue,n)};t.exports=a(chrome)}})})(de)),de.exports}var Ns=Fs();const I=dt(Ns),gt="*",Bs="[hidden]",zs=30,ht=50,$s=30,qs=240;function M(s,e="log"){const t=console[e];if(typeof t!="function")throw new TypeError(`Unknown log type: ${e}`);t(s)}function Hs(s){return s&&typeof s=="number"&&!isNaN(s)&&isFinite(s)?s:ht}function Vs(s,e){if(Gs(s))return zs;if(s<$s)return-1;const t=Math.round(s*e/100);return Math.min(t,qs)}function ft(s,e){if(s&&e){const t=gt.repeat(s.length);return e.replace(s,t)}return e}function bt(s){return s?typeof s=="string"?gt.repeat(s.length):Array.isArray(s)?`[Array(${s.length})]`:Bs:s===null?"null":s?.toString()??"undefined"}function Gs(s){return!s||typeof s!="number"||isNaN(s)||!isFinite(s)}function _(s,e){return new Promise((t,r)=>{const a=setTimeout(()=>{r(new Error("promise timeout"))},s);e.then(i=>{clearTimeout(a),t(i)},i=>{clearTimeout(a),r(i)})})}function pt(s,e){return s.some(t=>t===e)}function Ks(s,e){return s.length>0&&s.every(t=>t===e)}function Ws(){return!!(!self.window||(location.href.startsWith("safari-web-extension")||location.href.startsWith("moz-extension"))&&location.href.endsWith("generated_background_page.html"))}async function Js(s){const e=await fetch(s,{method:"GET"});return e.ok?e.text():null}class yt{events=new Map;on(e,t){const r=this.events.get(e)||[];this.events.set(e,[...r,t])}off(e,t){const r=this.events.get(e)||[];this.events.set(e,r.filter(a=>a!==t))}emit(e,...t){for(const r of this.events.get(e)||[])r(...t)}}function wt(s){const e=Object.entries(s).reduce((t,[r,a])=>(typeof a=="string"?t[r]=a:typeof a=="number"?t[r]=a.toString():(typeof a>"u"||a===null)&&(t[r]=""),t),{});return new URLSearchParams(e).toString()}function Ys(){return I.runtime.getManifest().version}function te(s,e){return I.i18n.getMessage(s,e)}const me="Base",K="Disallowed",jt="Disabled",_e="Error",Qs="Ignored",St="Loading",De="Playing",Zs="Paused",Fe="Scrobbled",Xs="Skipped",At="Unknown",er="Loved",tr="Unloved";function C(s){return e=>e(s)}function sr(...s){I.runtime.onMessage.addListener((e,t)=>{let r=!1;for(const a of s){const i=a(n=>{if(e.type===n.type)return r=!0,n.fn(e.payload,t)});if(r)return Promise.resolve(i)}})}async function rr(s,e){return I.tabs.sendMessage(s,e)}function ar(s){return e=>e(s)}function ir(...s){I.runtime.onMessage.addListener((e,t)=>{let r=!1;for(const a of s){const i=a(n=>{if(e.type===n.type)return r=!0,n.fn(e.payload,t)});if(r)return Promise.resolve(i)}})}async function v(s){return I.runtime.sendMessage(s)}const or=(async()=>Promise.resolve().then(()=>xr))(),nr=(async()=>Promise.resolve().then(()=>ba))(),Ne=", ",kt=[" -- ","--"," ~ "," - "," – "," — "," // ","-","–","—",":","|","///","/","~"];function Be(s){if(!s||!/^\s*-?((\d{1,2}:\d\d:\d\d)|(\d{1,2}:\d\d)|(\d{1,2}))\s*$/g.test(s))return 0;const t=/-/g,r=/\d{1,2}/g,a=s.match(r)?.reverse().map(i=>parseInt(i,10)).reduce((i,n,h)=>i+n*Math.pow(60,h));return a&&t.test(s)?-a:a??0}function vt(s,e=null){if(s===null||s.length===0)return null;for(const t of e||kt){const r=s.indexOf(t);if(r>-1)return{index:r,length:t.length}}return null}function lr(s){return!s||s.length===0?null:s.map(e=>e.textContent).join(Ne)}function ze(s,e=null,t=!1){if(!s)return{artist:null,track:null};const[r,a]=ge(s,e,t);return{artist:r,track:a}}const Rt=/^[A-Z][1-9]\.? /;function cr(s){return s!==null?s.replace(Rt,""):null}function ur(s,e=null,t=!1){const[r,a]=ge(s,e,t);return{artist:r,album:a}}function Tt(s,e="/",t=!1){if(s===null)return{currentTime:void 0,duration:void 0};const[r,a]=ge(s,[e],t).map(i=>Be(i));return{currentTime:r,duration:a}}function ge(s,e,t=!1){let r=null,a=null;if(s){const i=vt(s,e);i!==null&&(r=s.substr(0,i.index),a=s.substr(i.index+i.length),t&&([a,r]=[r,a]))}return[r,a]}function Et(s){return typeof s!="number"||isNaN(s)||!isFinite(s)?null:Math.round(s)}function It(s){if(!s)return null;const e=/url\((["']?)(.*)\1\)/.exec(s);return e?e[2].trim():null}function Ct(s,e){let t=0,r=setTimeout(()=>{},0);return()=>{const a=Date.now(),i=e-(a-t);if(i<=0)return t=a,s();clearTimeout(r),r=setTimeout(()=>{t=Date.now(),s()},i)}}function he(s){return!(s&&s.artist&&s.track)}function se(s,e,t){if(!e||!Array.isArray(t))return s;for(const r of t)!s[r]&&e[r]&&(s[r]=e[r]);return s}function xt(s){if(!(s&&s.metadata))return null;const{artist:e,album:t,title:r,artwork:a}=s.metadata,i=r;let n=null;if(a?.length>0){const{src:h}=a[a.length-1];n=h}return{artist:e,track:i,album:t,trackArt:n}}function D(s,e=null){if(s===null)return e;const t=F(s);if(!t)return e;for(const r of t){const a=r.innerText;if(a)return a}return e}function Pt(s,e,t=null){if(s===null)return t;const r=F(s);if(r){if(r.length===1)return r[0].getAttribute(e);for(const a of r){const i=a.getAttribute(e);if(i)return i}}return t}function dr(s,e,t){const r=F(s);if(r)for(const a of r)if(typeof e=="string")a.addEventListener(e,t);else for(const i of e)a.addEventListener(i,t)}function fe(s){return Be(D(s)??"")}function Lt(s){if(s===null)return null;const e=F(s);if(!e||!e.length)return null;let t=e[0].getAttribute("src");if(!t){const r=["background-image","background"],a=window.getComputedStyle(e[0]);for(const i of r){const n=a.getPropertyValue(i);n&&(t=It(n))}}return Ut(t)}function mr(s,e){const t=F(s);if(!t)return null;for(const r of t){const a=Ot(r,e);if(a)return a}return null}function Ot(s,e){return window.getComputedStyle(s).getPropertyValue(e)}function gr(s,e){if(s===null)return!1;const t=F(s);if(!t)return!1;for(const r of t)if(r.classList.contains(e))return!0;return!1}function hr(s){for(const e of s)if(e.offsetWidth||e.offsetHeight||e.getClientRects().length)return!0;return!1}function re(s){if(!s)return!1;const e=F(s);return(e&&hr(e))??!1}function fr(s){const e=F(s);return!e||!("value"in e)?null:e.value}function br(s,e){return Pt(s,`data-${e}`)}function F(s){if(!s)return null;if(typeof s=="string")return document.querySelectorAll(s);if(!Array.isArray(s))throw new TypeError(`Unknown type of selector: ${typeof s}`);for(const e of s){const t=document.querySelectorAll(e);if(t.length>0)return t}return null}async function pr(s,e){const t=await or,r=await t.getStorage(t.CONNECTORS_OPTIONS).get();return r&&s in r&&e in r[s]?r[s][e]:(w(`Option ${e} for connector ${s} not found`,"warn"),!1)}function Ut(s){return s?s.startsWith("//")?location.protocol+s:s.match(/^\/(?!\/)/g)?location.origin+s:s:null}function Mt(s){const e=document.createElement("script");e.src=s,e.onload=function(){const t=this;t.parentNode?.removeChild(t)},(document.head||document.documentElement).appendChild(e)}class yr{queue=[];isActive=!1;shouldPrint=nr.then(e=>e.getOption(e.DEBUG_LOGGING_ENABLED));push(e,t){this.queue.push({text:e,logType:t}),this.start()}async start(){if(!this.isActive){this.isActive=!0;try{for(let e=0;e<100&&this.queue.length>0;e++){const t=this.queue.shift();if(t&&await this.shouldPrint){const r=console[t.logType];if(typeof r!="function")throw new TypeError(`Unknown log type: ${t.logType}`);const a=`Web Scrobbler: ${t.text?.toString()}`;r(a)}}this.isActive=!1}catch{this.isActive=!1}}}}const wr=new yr;function w(s,e="log"){wr.push(s,e)}const _t=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?.*v=))([^#&?]*).*/,$e="Provided to YouTube",Dt="Auto-generated by YouTube.",Ft=" · ",Nt=[{pattern:/(.+?)([\s:—-])+\s*"(.+?)"/,groups:{artist:1,track:3}},{pattern:/(.+?)[『｢「](.+?)[」｣』]/,groups:{artist:1,track:2}},{pattern:/(\w[\s\w]*?)\s+\([^)]*\s*by\s*([^)]+)+\)/,groups:{artist:2,track:1}}];function jr(s){let e=null,t=null;if(!s)return{artist:e,track:t};let r=s.replace(/^((\[[^\]]+\])|(【[^】]+】))\s*-*\s*/i,"");r=r.replace(/^\s*([a-zA-Z]{1,2}|[0-9]{1,2})[1-9]?\.\s+/i,""),r=r.replace(/-\s*([「【『])/,"$1"),r=r.replace(/[(［【][^(［【]*?((Music Video)|(MV)|(PV)).*?[】］)]/i,""),r=r.replace(/[(［【]((オリジナル)|(東方)).*?[】］)]+?/,""),r=r.replace(/((?:Music Video)|MV|PV)([「［【『』】］」])/i,"$2"),r=r.replace(/\s+(MV|PV)$/i,"");for(const a of Nt){const i=a.pattern.exec(r);if(i){e=i[a.groups.artist],t=i[a.groups.track];break}}if(he({artist:e,track:t})&&({artist:e,track:t}=ze(r)),he({artist:e,track:t})){const a=/(.+?)【(.+?)】/.exec(r);a&&(e=a[1],t=a[2])}return he({artist:e,track:t})&&(t=r),{artist:e,track:t}}function Bt(s){return!!(s&&(s.startsWith($e)||s.endsWith(Dt)))}function Sr(s){if(!Bt(s))return null;const e=s.split(`
`).filter(k=>k.length>0).filter(k=>!k.startsWith($e)),t=e[0],r=e[1],a=t.split(Ft),i=a.length,n=r;let h=null,y=null,A=null;if(i<2)[y]=a;else if(i===2)[y,h]=a;else if([y,h,...A]=a,!A.some(O=>y?.includes(O))){const O=A.join(Ne);y=`${y} (feat. ${O})`}return{artist:h,track:y,album:n}}function Ar(s){if(!s)return null;const e=_t.exec(s);return e?e[7]:null}const zt=/(.+)\s[:\u2013-\u2015-]\s(.+)/;function kr(s){if(!s)return{artist:null,track:null};const e=zt.exec(s);return e&&!/.*#\d+.*/.test(e[1])?{artist:e[1],track:e[2]}:{artist:null,track:s}}function vr(s){const e=document.querySelector(s);return e===null?(w("Failed to resolve originUrl"),document.location.href):e.getAttribute("href")?.split("?")?.[0]??document.location.href}function Rr(s,e){if(!s)return te("pageActionLoading");const t=`${e?.getArtist()} - ${e?.getTrack()}`;switch(s){case K:return te("infoBoxStateDisallowed",t);case _e:return te("infoBoxStateError");case At:return te("infoBoxStateUnknown");default:return te(`pageAction${s}`,t)}}async function Tr(s,e,t){const r=await v({type:"fetch",payload:{url:s,init:t}});if(!r.ok)return{ok:!1,content:null};switch(e){case"text":return{ok:!0,content:r.content};case"json":return{ok:!0,content:JSON.parse(r.content)};case"html":return{ok:!0,content:new DOMParser().parseFromString(r.content,"text/html")}}}const Er=Object.freeze(Object.defineProperty({__proto__:null,ARTIST_SEPARATOR:Ne,RECORD_SIDE_REGEX:Rt,bindListeners:dr,debugLog:w,defaultSeparators:kt,escapeBadTimeValues:Et,extractImageUrlFromSelectors:Lt,extractUrlFromCssProperty:It,fetchFromServiceWorker:Tr,fillEmptyFields:se,findSeparator:vt,getAttrFromSelectors:Pt,getCSSProperty:Ot,getCSSPropertyFromSelectors:mr,getDataFromSelectors:br,getInfoBoxText:Rr,getMediaSessionInfo:xt,getOption:pr,getOriginUrl:vr,getSecondsFromSelectors:fe,getTextFromSelectors:D,getValueFromSelectors:fr,getYtVideoIdFromUrl:Ar,hasElementClass:gr,injectScriptIntoDocument:Mt,isArtistTrackEmpty:he,isElementVisible:re,isYtVideoDescriptionValid:Bt,joinArtists:lr,normalizeUrl:Ut,parseYtVideoDescription:Sr,processSoundCloudTrack:kr,processYtVideoTitle:jr,queryElements:F,removeRecordSide:cr,scArtistTrackRe:zt,splitArtistAlbum:ur,splitArtistTrack:ze,splitString:ge,splitTimeInfo:Tt,stringToSeconds:Be,throttle:Ct,ytDescFirstLine:$e,ytDescLastLine:Dt,ytDescSeparator:Ft,ytTitleRegExps:Nt,ytVideoIdRegExp:_t},Symbol.toStringTag,{value:"Module"}));var f=(s=>(s.RESULT_OK="ok",s.RESULT_IGNORE="ignored",s.ERROR_AUTH="error-auth",s.ERROR_OTHER="error-other",s))(f||{}),qe=(s=>(s.SUCCESSFUL="success",s.IGNORED="ignored",s.ERROR="error",s.DISALLOWED="disallowed",s.INVALID="invalid",s))(qe||{});function Ir(s,e){for(const t of s)if(t[e]===f.RESULT_IGNORE)return"ignored";for(const t of s)if(t[e]!==f.RESULT_OK)return"error";return"success"}const $t=3e3;class qt{storage;namespace;requests=[];autoIncrement=0;emitter=new yt;interval=setInterval(()=>{this.unlock()},$t);constructor(e,t){this.storage=e,this.namespace=t}unlock(){this.requests=this.requests.slice(1),this.emitter.emit("updateLock",this.requests[0]),clearInterval(this.interval),this.interval=setInterval(()=>{this.unlock()},$t)}async get(){const e=await this.storage.get();return e&&this.namespace in e?e[this.namespace]:null}async getLocking(){return await new Promise(t=>{const r=this.autoIncrement++;if(this.requests.push(r),this.requests[0]===r){t(!0);return}const a=i=>{i===r&&(t(!0),this.emitter.off("updateLock",a))};this.emitter.on("updateLock",a)}),this.get()}async set(e){const t={[this.namespace]:e};await this.storage.set(t)}async setLocking(e){try{await this.set(e)}catch(t){w(t,"warn")}this.unlock()}async update(e){const t=await this.getLocking(),r=Object.assign(t??{},e);await this.setLocking(r)}async debugLog(e=[]){const t=await this.get(),a=JSON.stringify(t,(i,n)=>e.includes(i)?bt(n):n,2);location?.protocol==="chrome-extension:"&&w(`storage.${this.namespace} = ${a}`,"info")}async clear(){await this.storage.remove(this.namespace)}}const R=0,W=1,He="Connectors",Ve="ConnectorsOverrideOptions",Ge="customPatterns",Ht="Notifications",Ke="BlockedTags",ae="LocalCache",Vt="NativeScrobblerNotification",We="Blocklists",be="Options",Gt="StateManagement",pe="DisabledTabs",ye="RegexEdits",we="ScrobbleCache",Kt="Core",Cr={[He]:W,[Ve]:W,[Ge]:W,[Ht]:W,[be]:W,LastFM:R,LibreFM:R,ListenBrainz:R,Maloja:R,Webhook:R,Pleroma:R,[Vt]:R,[We]:R,[ae]:R,[ye]:R,[we]:R,[Ke]:R,[Kt]:R,[Gt]:R,[pe]:R};function T(s){switch(Cr[s]){case W:return Jt(s);case R:return J(s);default:throw new Error(`Unknown storage namespace: ${s}`)}}function Wt(s){return J(s)}function J(s){const e=I.storage.local;return new qt(e,s)}function Jt(s){const e=I.storage.sync||I.storage.local;return new qt(e,s)}const xr=Object.freeze(Object.defineProperty({__proto__:null,BLOCKED_TAGS:Ke,BLOCKLISTS:We,CONNECTORS_OPTIONS:He,CONNECTORS_OVERRIDE_OPTIONS:Ve,CORE:Kt,CUSTOM_PATTERNS:Ge,DISABLED_TABS:pe,LOCAL_CACHE:ae,NATIVE_SCROBBLER_NOTIFICATION:Vt,NOTIFICATIONS:Ht,OPTIONS:be,REGEX_EDITS:ye,SCROBBLE_CACHE:we,STATE_MANAGEMENT:Gt,getLocalStorage:J,getScrobblerStorage:Wt,getStorage:T,getSyncStorage:Jt},Symbol.toStringTag,{value:"Module"})),Pr=T(Ge);function Lr(){return Pr.get()}async function Or(s){const e=await Lr()||{};for(const t of Me){const r=t.matches||[];e[t.id]&&r.push(...e[t.id]);for(const a of r)if(_s(s,a))return t}return null}function Ur(s){if(!Array.isArray(s))throw new TypeError(`Invalid 'fields' argument: expected 'string[]', got '${typeof s}'`);if(s.length===0)throw new Error("Invalid 'fields' argument: received an empty array");for(const e of s){if(typeof e!="string")throw new TypeError(`Invalid field: expected 'string', got '${typeof e}'`);if(!e)throw new TypeError("Invalid field: expected 'string', got an empty string")}}function Mr(s){if(!s)throw new TypeError("No filter set is specified!");if(typeof s!="object")throw new TypeError(`Invalid filter set: expected 'object', got '${typeof s}'`);for(const e in s)Yt(s[e])}function Yt(s){Array.isArray(s)?_r(s):Qt(s)}function _r(s){s.forEach(Qt)}function Qt(s){if(typeof s!="function")throw new TypeError(`Invalid filter function: expected 'function', got '${typeof s}'`)}function Zt(s){return new N(s)}function Xt(s,e){return Ur(s),Yt(e),s.reduce((t,r)=>(t[r]=e,t),{})}class N{constructor(e){this.mergedFilterSet={},this.appendFilters(e)}filterField(e,t){if(e in this.mergedFilterSet)return this.filterText(t,this.mergedFilterSet[e]);throw new TypeError(`Invalid filter field: ${e}`)}append(e){return this.appendFilters(e),this}extend(e){if(!e)throw new TypeError("No filter is specified!");if(!(e instanceof N))throw new TypeError(`Invalid filter: expected 'MetadataFilter', got '${typeof e}'`);return this.appendFilters(e.mergedFilterSet),this}canFilterField(e){return e in this.mergedFilterSet}getFields(){return Object.keys(this.mergedFilterSet)}filterText(e,t){return e&&t.reduce((r,a)=>a(r),e)}wrapFiltersIntoArray(e){return Array.isArray(e)?e:[e]}appendFilters(e){Mr(e);for(const t in e){t in this.mergedFilterSet||(this.mergedFilterSet[t]=[]);const r=this.wrapFiltersIntoArray(e[t]);this.mergedFilterSet[t].push(...r)}}}const Dr=[{source:/\s[([]Explicit[)\]]/i,target:""},{source:/\s[([]Clean[)\]]/i,target:""}],Fr=[{source:/\s[([]feat. .+[)\]]/i,target:""},{source:/\s(feat. .+)/i,target:""}],Nr=[{source:/\s-\sLive(\s.+)?$/,target:""},{source:/\s[([]Live[)\]]$/,target:""}],Br=[{source:/\s[([](feat. .+)[)\]]/i,target:" $1"}],zr=[{source:/\s\(Parody of ".*" by .*\)$/,target:""},{source:/\s\(Parody of ".*" by .* feat\. .*\)$/,target:""},{source:/\s\(Lyrical Adaption of ".*"\)$/,target:""}],$r=[{source:/\sRe-?issue$/i,target:""},{source:/\s\[.*?Re-?issue.*?\]/i,target:""},{source:/\s\(.*?Re-?issue.*?\)/i,target:""}],qr=[{source:/Live\s\/\sRemastered/,target:"Live"},{source:/\s[([].*Re-?[Mm]aster(ed)?.*[)\]]$/,target:""},{source:/\s-\s\d{4}(\s-)?\s.*Re-?[Mm]aster(ed)?.*$/,target:""},{source:/\s-\sRe-?[Mm]aster(ed)?.*$/,target:""},{source:/\s\[Remastered\]\s\(Remastered\sVersion\)$/,target:""}],Hr=[{source:/-\s(.+?)\s((Re)?mix|edit|dub|mix|vip|version)$/i,target:"($1 $2)"},{source:/-\s(Remix|VIP|Instrumental)$/i,target:"($1)"}],Vr=[{source:/\(+\s*\)+/,target:""},{source:/^[/,:;~\s"-]+/,target:""},{source:/[/,:;~\s"-]+$/,target:""},{source:/\u0020{1,}/,target:" "}],Gr=[{source:/(Various Artists).+/,target:"$1"}],Kr=[{source:/\s[([]Album Version[)\]]$/,target:""},{source:/\s[([]Re-?recorded[)\]]$/,target:""},{source:/\s[([]Single Version[)\]]$/,target:""},{source:/\s[([]Edit[)\]]$/,target:""},{source:/\s-\sMono Version$/,target:""},{source:/\s-\sStereo Version$/,target:""},{source:/\s\(Deluxe Edition\)$/,target:""},{source:/\s[([]Expanded.*[)\]]$/,target:""},{source:/\s-\sExpanded Edition$/,target:""},{source:/\s[([]Explicit Version[)\]]/i,target:""},{source:/\s[([]Bonus Track Edition[)\]]/i,target:""},{source:/\s[([]\d+th\sAnniversary.*[)\]]/i,target:""},{source:/\s-\sOriginal$/i,target:""},{source:/\s-\sOriginal.*Version(\s\d{4})?$/i,target:""}],Wr=[{source:/^\s+|\s+$/g,target:""},{source:/\*+\s?\S+\s?\*+$/,target:""},{source:/\[[^\]]+\]/,target:""},{source:/【[^\]]+】/,target:""},{source:/（[^\]]+）/,target:""},{source:/\([^)]*version\)$/i,target:""},{source:/\.(avi|wmv|mpg|mpeg|flv)$/i,target:""},{source:/\(.*lyrics?\s*(video)?\)/i,target:""},{source:/\((of+icial\s*)?(track\s*)?stream\)/i,target:""},{source:/\((of+icial\s*)?(music\s*)?(video|audio)\)/i,target:""},{source:/-\s(of+icial\s*)?(music\s*)?(video|audio)$/i,target:""},{source:/\(.*Album\sTrack\)/i,target:""},{source:/\(\s*of+icial\s*\)/i,target:""},{source:/\(\s*[0-9]{4}\s*\)/i,target:""},{source:/\(\s*(HD|HQ)\s*\)$/,target:""},{source:/(HD|HQ)\s?$/,target:""},{source:/(vid[\u00E9e]o)?\s?clip\sof+ici[ae]l/i,target:""},{source:/of+iziel+es\s*video/i,target:""},{source:/vid[\u00E9e]o\s?clip/i,target:""},{source:/\sclip/i,target:""},{source:/full\s*album/i,target:""},{source:/\(live.*?\)$/i,target:""},{source:/\|.*$/i,target:""},{source:/^(|.*\s)"(.{5,})"(\s.*|)$/,target:"$2"},{source:/^(|.*\s)'(.{5,})'(\s.*|)$/,target:"$2"},{source:/\(.*[0-9]{1,2}\/[0-9]{1,2}\/[0-9]{2,4}.*\)/i,target:""},{source:/sub\s*español/i,target:""},{source:/\s\(Letra\)/i,target:""},{source:/\s\(En\svivo\)/i,target:""},{source:/sub\s*español/i,target:""}],Jr=[{source:/\s(& .+)/i,target:""},{source:/\s(x .+)/i,target:""}],es={"&":/&amp;/g,"<":/&lt;/g,">":/&gt;/g,'"':/&quot;/g};function ts(s){return s.includes(" feat. ")?s.split(" feat. ")[0]:s}function ss(s){let e=s;for(const t in es){const r=es[t];e=e.replace(r,t)}return e=e.replace(/&#x([a-fA-f0-9]+);/g,(t,r)=>{const a=parseInt(r,16);return String.fromCharCode(a)}),e=e.replace(/&#(\d+);/g,(t,r)=>String.fromCharCode(r)),e}function x(s,e){return e.reduce((t,r)=>{const{source:a,target:i}=r;return t.replace(a,i)},s)}function q(s){return x(s,Hr)}function Yr(s){return x(s,Gr)}function Je(s){return x(s,Br)}function Ye(s){return x(s,Dr)}function rs(s){return x(s,Fr)}function Qr(s){return x(s,Jr)}function H(s){return x(s,Nr)}function as(s){return x(s,zr)}function is(s){return x(s,$r)}function B(s){return x(s,qr)}function Y(s){return x(s,Kr)}function Zr(s){return s.replace(/[\u200B-\u200D\uFEFF]/g,"")}function os(s){return s.replace(/\u00a0/g," ")}function ns(s){return x(s,[...Wr,...Vr])}function Xr(s){return s.replace(/[\u2018\u2019]/g,"'").replace(/[\u201c\u201d]/g,'"')}function ea(){return new N({track:ns})}function ta(){return new N({track:B,album:B})}function sa(){return new N({track:[B,as,q,H],album:[B,q,H,is,Y]})}function ra(){return new N({artist:[Je],track:[Ye,rs,B,q,Y,H],album:[ss,Ye,B,q,Y,H],albumArtist:[Je,ts]})}function aa(){return new N({track:[B,q,Y,H],album:[B,q,Y,H]})}const ia=Object.freeze(Object.defineProperty({__proto__:null,MetadataFilter:N,albumArtistFromArtist:ts,createAmazonFilter:ra,createFilter:Zt,createFilterSetForFields:Xt,createRemasteredFilter:ta,createSpotifyFilter:sa,createTidalFilter:aa,createYouTubeFilter:ea,decodeHtmlEntities:ss,filterWithFilterRules:x,fixTrackSuffix:q,fixVariousArtists:Yr,normalizeFeature:Je,removeAdditionalArtists:Qr,removeCleanExplicit:Ye,removeFeature:rs,removeLive:H,removeParody:as,removeReissue:is,removeRemastered:B,removeVersion:Y,removeZeroWidth:Zr,replaceNbsp:os,replaceSmartQuotes:Xr,youtube:ns},Symbol.toStringTag,{value:"Module"}));class ls{meta;artistSelector=null;trackSelector=null;albumSelector=null;albumArtistSelector=null;currentTimeSelector=null;remainingTimeSelector=null;durationSelector=null;timeInfoSelector=null;artistTrackSelector=null;playButtonSelector=null;pauseButtonSelector=null;playerSelector=null;scrobbleInfoLocationSelector=null;scrobbleInfoStyle={display:"flex",gap:"0.5em",alignItems:"center"};getChannelId=null;channelLabelSelector=null;getChannelLabel=()=>D(this.channelLabelSelector);getChannelInfo=()=>{const e=this.getChannelId?.();return e?{id:e,label:this.getChannelLabel?.()||e}:null};trackArtSelector=null;getArtist;getTrack;getAlbum;getAlbumArtist;getDuration;getCurrentTime;getRemainingTime;getTimeInfo;getArtistTrack;getTrackInfo=()=>null;getUniqueID=()=>null;isPlaying;isPodcast=()=>!1;getTrackArt;isTrackArtDefault=()=>!1;loveButtonSelector=null;unloveButtonSelector=null;isLoved=()=>{if(this.loveButtonSelector){if(re(this.loveButtonSelector))return!1;if(!this.unloveButtonSelector)return!0}if(this.unloveButtonSelector){if(re(this.unloveButtonSelector))return!0;if(!this.loveButtonSelector)return!1}return null};isStateChangeAllowed=()=>!0;scrobblingDisallowedReason=()=>null;onReady=()=>{};onScriptEvent=()=>{};defaultFilter=Zt(Xt(["artist","track","album","albumArtist"],[e=>e.trim(),os]));applyFilter;resetState;injectScript=e=>{if(window.webScrobblerScripts||(window.webScrobblerScripts={}),window.webScrobblerScripts[e])return;const t=I.runtime.getURL(e);Mt(t),w(`Injected ${e}`),window.addEventListener("message",r=>{typeof r.data!="object"||!("sender"in r.data)||r.data.sender!=="web-scrobbler"||this.onScriptEvent(r)}),window.webScrobblerScripts[e]=!0};onStateChanged;useMediaSessionApi=()=>{this.isMediaSessionAllowed="mediaSession"in navigator};isPlayingAsync=!0;tabAudibleFetchingInterval=null;useTabAudibleApi=()=>{this.isPlaying=()=>this.isPlayingAsync,this.tabAudibleFetchingInterval!==null&&clearInterval(this.tabAudibleFetchingInterval),this.tabAudibleFetchingInterval=setInterval(()=>{v({type:"isTabAudible",payload:void 0}).then(e=>{this.isPlayingAsync=e,this.onStateChanged()}).catch(()=>{this.isPlayingAsync=!0,this.onStateChanged()})},1e3)};getOriginUrl=()=>document.location.href;isMediaSessionAllowed=!1;metadataFilter=this.defaultFilter;defaultState={track:null,artist:null,album:null,albumArtist:null,uniqueID:null,duration:null,currentTime:null,isPlaying:!0,trackArt:null,isPodcast:!1,originUrl:null,scrobblingDisallowedReason:null};mediaSessionFields=["artist","track","album","trackArt"];artistTrackFields=["artist","track"];timeInfoFields=["duration","currentTime"];currentState=Object.assign({},this.defaultState);filteredState=Object.assign({},this.defaultState);isStateReset=!1;_controllerCallback=null;get controllerCallback(){return this._controllerCallback}set controllerCallback(e){e(this.getCurrentState()),this._controllerCallback=e}_isLovedCallback=null;get isLovedCallback(){return this._isLovedCallback}set isLovedCallback(e){e(this.isLoved()??null),this._isLovedCallback=e}stateChangedWorker;getCurrentState;filterState;stateChangedWorkerThrottled;constructor(e){this.meta=e,this.getArtist=()=>D(this.artistSelector),this.getTrack=()=>D(this.trackSelector),this.getAlbum=()=>D(this.albumSelector),this.getAlbumArtist=()=>D(this.albumArtistSelector),this.getDuration=()=>fe(this.durationSelector),this.getCurrentTime=()=>fe(this.currentTimeSelector),this.getRemainingTime=()=>fe(this.remainingTimeSelector),this.getTimeInfo=()=>Tt(D(this.timeInfoSelector)),this.getArtistTrack=()=>ze(D(this.artistTrackSelector)),this.isPlaying=()=>this.playButtonSelector?!re(this.playButtonSelector):this.pauseButtonSelector?re(this.pauseButtonSelector):!0,this.getTrackArt=()=>Lt(this.trackArtSelector),this.applyFilter=t=>{this.metadataFilter=t.extend(this.defaultFilter)},this.resetState=()=>{this.isStateReset||(this.controllerCallback!==null&&this.controllerCallback({}),this.isStateReset=!0)},this.onStateChanged=()=>{if(!this.isStateChangeAllowed())return;this.isPlaying()!==this.currentState.isPlaying?this.stateChangedWorker():this.stateChangedWorkerThrottled()},this.stateChangedWorker=()=>{this.isStateReset=!1;const t=[],r=this.getCurrentState();for(const a in this.currentState){let i;const n=a;r[n]||r[n]===!1?i=r[n]:i=this.defaultState[n];const h=this.currentState[n];i!==h&&(this.currentState[n]=i,t.push(n))}t.length>0&&(this.filterState(t),this.controllerCallback!==null&&this.controllerCallback(this.filteredState)),this.isLovedCallback?.(this.isLoved()??null)},this.getCurrentState=()=>{const t={albumArtist:this.getAlbumArtist(),uniqueID:this.getUniqueID(),duration:this.getDuration(),currentTime:this.getCurrentTime(),isPlaying:this.isPlaying(),isPodcast:this.isPodcast(),originUrl:this.getOriginUrl(),scrobblingDisallowedReason:this.scrobblingDisallowedReason()};let r=null;if(this.isMediaSessionAllowed){const{mediaSession:y}=navigator;r=xt(y)}r||(r={trackArt:this.getTrackArt(),artist:this.getArtist(),track:this.getTrack(),album:this.getAlbum()}),se(t,r,this.mediaSessionFields);const a=Math.abs(this.getRemainingTime()??0);a&&(!t.currentTime&&t.duration&&(t.currentTime=t.duration-a),!t.duration&&t.currentTime&&(t.duration=t.currentTime+a));const i=this.getTimeInfo();se(t,i,this.timeInfoFields);const n=this.getArtistTrack();se(t,n,this.artistTrackFields);const h=this.getTrackInfo();return h!==null&&se(t,h,Object.keys(this.defaultState)),t},this.filterState=t=>{for(const r of t){let a=this.currentState[r];switch(r){case"albumArtist":a===this.currentState.artist&&(a=this.defaultState[r]);case"artist":case"track":case"album":{if(a==null){a=this.defaultState[r];break}a=this.metadataFilter.filterField(r,a)||this.defaultState[r];break}case"currentTime":case"duration":{if(a==null){a=this.defaultState[r];break}a=Et(a)||this.defaultState[r];break}case"trackArt":a&&this.isTrackArtDefault(a)&&(a=null);break}this.filteredState[r]=a}},this.stateChangedWorkerThrottled=Ct(this.stateChangedWorker,500),setTimeout(()=>{this.onStateChanged()},1e3)}}const P=T(be),Q=T(He),je=T(Ve),Qe="useNotifications",Ze="useUnrecognizedSongNotifications",Se="showInfobox",Ae="scrobblePodcasts",ke="autoToggleLove",ve="forceRecognize",Xe="scrobbleRecognizedTracks",Re="scrobbleEditedTracksOnly",et="scrobblePercent",L="disabledConnectors",cs="debugLoggingEnabled",tt="albumGuessingDisabled",us="albumGuessingUneditedOnly",st="albumGuessingAllTracks",ds={[ve]:!1,[Ae]:!0,[Qe]:!0,[Ze]:!1,[Xe]:!0,[Re]:!1,[cs]:!1,[et]:ht,[Se]:!0,[ke]:!0,[tt]:!1,[us]:!0,[st]:!1,[L]:{}},oa={[ve]:!1,[Xe]:!0,[Re]:!1,[Ae]:!0,[Qe]:!0,[Ze]:!1,[Se]:!0,[ke]:!0},ie={YouTube:{scrobbleMusicOnly:!1,scrobbleEntertainmentOnly:!1,scrobbleMusicRecognisedOnly:!1,enableGetTrackInfoFromYtMusic:!1}};async function na(){const s={...ds,...await P.get()};await P.set(s),P.debugLog([L]);const e={...ie,...await Q.get()};for(const t in ie){const r=t;e[r]={...ie[r],...e[r]}}await Q.set(e),Q.debugLog(),je.debugLog()}async function la(){const s=await P.get();if(!s)throw new Error("No options data found");for(const e of Object.keys(s[L])){let t=!1;for(const r of Me)if(r.id===e){t=!0;break}t||(delete s[L][e],w(`Remove ${e} from storage`))}}async function z(s,e){if(gs(s),e!==void 0){const r=await ms(e,s);if(r!==void 0)return r}return(await P.get())?.[s]}async function ca(s,e){gs(s),await P.update({[s]:e})}async function ua(s,e){return hs(s),fs(s,e),(await Q.get())?.[s][e]}async function da(s,e,t){hs(s),fs(s,e);const r=await Q.get();if(!r?.[s])throw new Error(`Connector ${s} not found in storage`);r[s][e]=t,await Q.set(r)}async function ms(s,e){return ga(e)?(await je.get())?.[s]?.[e]:void 0}async function ma(s,e,t){const r=await je.get();if(!r)throw new Error("No connectors override data found");r[s]||(r[s]={}),r[s][e]=t,await je.set(r)}function gs(s){if(!(s in ds))throw new Error(`Unknown option key: ${s}`);return!0}function ga(s){return s in oa}function hs(s){if(!(s in ie))throw new Error(`Unknown connector: ${s}`);return!0}function fs(s,e){if(!(e in ie[s]))throw new Error(`Unknown connector option key: ${e}`);return!0}async function ha(s){const e=await P.get();if(!e)throw new Error("No options data found");return!e[L][s.id]}async function bs(s,e){const t=await P.get();if(!t)throw new Error("No options data found");e?delete t[L][s.id]:t[L][s.id]=!0,await P.set(t)}async function fa(s){const e=await P.get();if(!e)throw new Error("No options data found");if(e[L]={},!s)for(const t of Me)e[L][t.id]=!0;await P.set(e)}na().then(la);const ba=Object.freeze(Object.defineProperty({__proto__:null,ALBUM_GUESSING_ALL_TRACKS:st,ALBUM_GUESSING_DISABLED:tt,ALBUM_GUESSING_UNEDITED_ONLY:us,AUTO_TOGGLE_LOVE:ke,DEBUG_LOGGING_ENABLED:cs,DISABLED_CONNECTORS:L,FORCE_RECOGNIZE:ve,SCROBBLE_EDITED_TRACKS_ONLY:Re,SCROBBLE_PERCENT:et,SCROBBLE_PODCASTS:Ae,SCROBBLE_RECOGNIZED_TRACKS:Xe,USE_INFOBOX:Se,USE_NOTIFICATIONS:Qe,USE_UNRECOGNIZED_SONG_NOTIFICATIONS:Ze,getConnectorOption:ua,getConnectorOverrideOption:ms,getOption:z,isConnectorEnabled:ha,setAllConnectorsEnabled:fa,setConnectorEnabled:bs,setConnectorOption:da,setConnectorOverrideOption:ma,setOption:ca},Symbol.toStringTag,{value:"Module"}));class rt{getArtist(){return this.processed.artist||this.parsed.artist}getTrack(){return this.processed.track||this.parsed.track}getAlbum(){return this.processed.album||this.parsed.album}getAlbumArtist(){return this.processed.albumArtist||this.parsed.albumArtist}getDuration(){return this.parsed.duration||this.processed.duration}getTrackArt(){return this.parsed.trackArt||this.metadata.trackArtUrl||null}getArtistTrackString(){return this.isEmpty()?null:`${this.getArtist()??"undefined"} — ${this.getTrack()??"undefined"}`}getUniqueId(){return this.parsed.uniqueID}getOriginUrl(){return this.parsed.originUrl}isEmpty(){return!(this.getArtist()&&this.getTrack())}isValid(){return this.flags.isValid||this.flags.isCorrectedByUser}equals(e){if(!e||!(e instanceof rt))return!1;const t=this.getUniqueId(),r=e.getUniqueId();return t||r?t===r:this.getArtist()===e.getArtist()&&this.getTrack()===e.getTrack()&&this.getAlbum()===e.getAlbum()}toString(){return JSON.stringify(this,null,2)}getCloneableData(){return{parsed:this.parsed,noRegex:this.noRegex,processed:this.processed,metadata:this.metadata,flags:this.flags,connector:this.connector}}setLoveStatus(e,t=!1){if(t){this.metadata.userloved=e;return}e?this.metadata.userloved===void 0&&(this.metadata.userloved=!0):this.metadata.userloved=!1}static get USER_FIELDS(){return["artist","track","album","albumArtist"]}static get BASE_FIELDS(){return["artist","track","album","albumArtist"]}static get PROCESSED_FIELDS(){return["track","album","artist","albumArtist","duration"]}}class Z extends rt{parsed;processed;noRegex;flags;metadata;connector;constructor(e,t){super(),this.parsed=Object.assign({track:null,artist:null,albumArtist:null,album:null,duration:null},e),this.processed={track:null,artist:null,albumArtist:null,album:null,duration:null},this.noRegex={track:null,artist:null,albumArtist:null,album:null,duration:null},this.flags={},this.metadata={},this.connector=t,this.initSongData()}resetInfo(){this.initProcessedData()}resetData(){this.initFlags(),this.initMetadata()}initSongData(){this.initFlags(),this.initMetadata(),this.initProcessedData()}initFlags(){this.flags={isScrobbled:!1,isCorrectedByUser:!1,isRegexEditedByUser:{track:!1,artist:!1,album:!1,albumArtist:!1},isAlbumFetched:!1,isValid:!1,isMarkedAsPlaying:!1,isSkipped:!1,isReplaying:!1,hasBlockedTag:!1,isLovedInService:null,finishedProcessing:!1}}initMetadata(){this.metadata={userloved:void 0,startTimestamp:Math.floor(Date.now()/1e3),label:this.connector.label}}initProcessedData(){for(const e of Z.PROCESSED_FIELDS)this.processed[e]=null,this.noRegex[e]=null}}class ps{targetSeconds=null;startedOn=null;pausedOn=null;spentPaused=0;callback=null;hasTriggered=!1;timeoutId=null;constructor(){this.reset()}reset(){this.targetSeconds=null,this.startedOn=null,this.pausedOn=null,this.spentPaused=0,this.callback=null,this.hasTriggered=!1,this.clearTrigger()}start(e){this.reset(),this.startedOn=oe(),this.callback=e}pause(){this.startedOn!==null&&this.pausedOn===null&&(this.pausedOn=oe(),this.clearTrigger())}resume(){this.startedOn!==null&&this.pausedOn!==null&&(this.spentPaused+=oe()-this.pausedOn,this.pausedOn=null,!this.hasTriggered&&this.targetSeconds!==null&&this.targetSeconds!==void 0&&this.setTrigger(this.targetSeconds-this.getElapsed()))}update(e){this.startedOn!==null&&(this.targetSeconds=e,this.targetSeconds!==null&&this.targetSeconds!==void 0?this.pausedOn===null&&this.setTrigger(this.targetSeconds-this.getElapsed()):this.clearTrigger())}getRemainingSeconds(){return this.targetSeconds===null||this.targetSeconds===void 0?null:this.targetSeconds-this.getElapsed()}isExpired(){const e=this.getRemainingSeconds();return e!==null&&e<0}setTrigger(e){this.clearTrigger(),this.timeoutId=window.setTimeout(()=>{this.callback&&(this.callback(),this.hasTriggered=!0)},e*1e3)}clearTrigger(){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=null}getElapsed(){if(this.startedOn===null)throw Error("elapsed time called before alarm started");let e=oe()-this.startedOn-this.spentPaused;return this.pausedOn!==null&&(e-=oe()-this.pausedOn),e}}function oe(){return Math.round(new Date().valueOf()/1e3)}var Te={exports:{}},pa=Te.exports,ys;function ya(){return ys||(ys=1,(function(s){(function(e){function t(c,u){var o=(c&65535)+(u&65535),b=(c>>16)+(u>>16)+(o>>16);return b<<16|o&65535}function r(c,u){return c<<u|c>>>32-u}function a(c,u,o,b,p,j){return t(r(t(t(u,c),t(b,j)),p),o)}function i(c,u,o,b,p,j,S){return a(u&o|~u&b,c,u,p,j,S)}function n(c,u,o,b,p,j,S){return a(u&b|o&~b,c,u,p,j,S)}function h(c,u,o,b,p,j,S){return a(u^o^b,c,u,p,j,S)}function y(c,u,o,b,p,j,S){return a(o^(u|~b),c,u,p,j,S)}function A(c,u){c[u>>5]|=128<<u%32,c[(u+64>>>9<<4)+14]=u;var o,b,p,j,S,m=1732584193,l=-271733879,g=-1732584194,d=271733878;for(o=0;o<c.length;o+=16)b=m,p=l,j=g,S=d,m=i(m,l,g,d,c[o],7,-680876936),d=i(d,m,l,g,c[o+1],12,-389564586),g=i(g,d,m,l,c[o+2],17,606105819),l=i(l,g,d,m,c[o+3],22,-1044525330),m=i(m,l,g,d,c[o+4],7,-176418897),d=i(d,m,l,g,c[o+5],12,1200080426),g=i(g,d,m,l,c[o+6],17,-1473231341),l=i(l,g,d,m,c[o+7],22,-45705983),m=i(m,l,g,d,c[o+8],7,1770035416),d=i(d,m,l,g,c[o+9],12,-1958414417),g=i(g,d,m,l,c[o+10],17,-42063),l=i(l,g,d,m,c[o+11],22,-1990404162),m=i(m,l,g,d,c[o+12],7,1804603682),d=i(d,m,l,g,c[o+13],12,-40341101),g=i(g,d,m,l,c[o+14],17,-1502002290),l=i(l,g,d,m,c[o+15],22,1236535329),m=n(m,l,g,d,c[o+1],5,-165796510),d=n(d,m,l,g,c[o+6],9,-1069501632),g=n(g,d,m,l,c[o+11],14,643717713),l=n(l,g,d,m,c[o],20,-373897302),m=n(m,l,g,d,c[o+5],5,-701558691),d=n(d,m,l,g,c[o+10],9,38016083),g=n(g,d,m,l,c[o+15],14,-660478335),l=n(l,g,d,m,c[o+4],20,-405537848),m=n(m,l,g,d,c[o+9],5,568446438),d=n(d,m,l,g,c[o+14],9,-1019803690),g=n(g,d,m,l,c[o+3],14,-187363961),l=n(l,g,d,m,c[o+8],20,1163531501),m=n(m,l,g,d,c[o+13],5,-1444681467),d=n(d,m,l,g,c[o+2],9,-51403784),g=n(g,d,m,l,c[o+7],14,1735328473),l=n(l,g,d,m,c[o+12],20,-1926607734),m=h(m,l,g,d,c[o+5],4,-378558),d=h(d,m,l,g,c[o+8],11,-2022574463),g=h(g,d,m,l,c[o+11],16,1839030562),l=h(l,g,d,m,c[o+14],23,-35309556),m=h(m,l,g,d,c[o+1],4,-1530992060),d=h(d,m,l,g,c[o+4],11,1272893353),g=h(g,d,m,l,c[o+7],16,-155497632),l=h(l,g,d,m,c[o+10],23,-1094730640),m=h(m,l,g,d,c[o+13],4,681279174),d=h(d,m,l,g,c[o],11,-358537222),g=h(g,d,m,l,c[o+3],16,-722521979),l=h(l,g,d,m,c[o+6],23,76029189),m=h(m,l,g,d,c[o+9],4,-640364487),d=h(d,m,l,g,c[o+12],11,-421815835),g=h(g,d,m,l,c[o+15],16,530742520),l=h(l,g,d,m,c[o+2],23,-995338651),m=y(m,l,g,d,c[o],6,-198630844),d=y(d,m,l,g,c[o+7],10,1126891415),g=y(g,d,m,l,c[o+14],15,-1416354905),l=y(l,g,d,m,c[o+5],21,-57434055),m=y(m,l,g,d,c[o+12],6,1700485571),d=y(d,m,l,g,c[o+3],10,-1894986606),g=y(g,d,m,l,c[o+10],15,-1051523),l=y(l,g,d,m,c[o+1],21,-2054922799),m=y(m,l,g,d,c[o+8],6,1873313359),d=y(d,m,l,g,c[o+15],10,-30611744),g=y(g,d,m,l,c[o+6],15,-1560198380),l=y(l,g,d,m,c[o+13],21,1309151649),m=y(m,l,g,d,c[o+4],6,-145523070),d=y(d,m,l,g,c[o+11],10,-1120210379),g=y(g,d,m,l,c[o+2],15,718787259),l=y(l,g,d,m,c[o+9],21,-343485551),m=t(m,b),l=t(l,p),g=t(g,j),d=t(d,S);return[m,l,g,d]}function k(c){var u,o="",b=c.length*32;for(u=0;u<b;u+=8)o+=String.fromCharCode(c[u>>5]>>>u%32&255);return o}function O(c){var u,o=[];for(o[(c.length>>2)-1]=void 0,u=0;u<o.length;u+=1)o[u]=0;var b=c.length*8;for(u=0;u<b;u+=8)o[u>>5]|=(c.charCodeAt(u/8)&255)<<u%32;return o}function Ce(c){return k(A(O(c),c.length*8))}function X(c,u){var o,b=O(c),p=[],j=[],S;for(p[15]=j[15]=void 0,b.length>16&&(b=A(b,c.length*8)),o=0;o<16;o+=1)p[o]=b[o]^909522486,j[o]=b[o]^1549556828;return S=A(p.concat(O(u)),512+u.length*8),k(A(j.concat(S),640))}function V(c){var u="0123456789abcdef",o="",b,p;for(p=0;p<c.length;p+=1)b=c.charCodeAt(p),o+=u.charAt(b>>>4&15)+u.charAt(b&15);return o}function G(c){return unescape(encodeURIComponent(c))}function xe(c){return Ce(G(c))}function Pe(c){return V(xe(c))}function Le(c,u){return X(G(c),G(u))}function Oe(c,u){return V(Le(c,u))}function Ue(c,u,o){return u?o?Le(u,c):Oe(u,c):o?xe(c):Pe(c)}s.exports?s.exports=Ue:e.md5=Ue})(pa)})(Te)),Te.exports}var wa=ya();const ws=dt(wa);class at{storageRef;constructor(){this.storageRef=null}_init(e){this.storageRef=e}async clear(){if(this.storageRef)return await this.storageRef.clear()}async getData(){return this.storageRef?await this.storageRef.get():(M("Storage reference is not initialized","warn"),null)}async saveData(e){if(!this.storageRef){M("Storage reference is not initialized","warn");return}return await this.storageRef.set(e)}async updateData(e){if(!this.storageRef){M("Storage reference is not initialized","warn");return}return await this.storageRef.update(e)}}class $ extends at{async loadSongInfo(e){let t=$.getSongId(e);const r=await this.getSongInfoStorage();if((!r||!(t in r))&&(t=$.makeSongId(e,["artist","track","album"])),(!r||!(t in r))&&(t=$.makeSongId(e,["artist","track"])),r&&t in r){const a=r[t];return $.applyLoadedInfo(e,a),!0}return!1}async saveSongInfo(e,t){const r=$.getSongId(e),a=await this.getSongInfoStorage();if(a===null){await this.saveSongInfoToStorage({[r]:t});return}a[r]={...a[r],...t},await this.saveSongInfoToStorage(a)}async removeSongInfo(e){if(e===null)throw new Error("Song is null");const t=$.getSongId(e);await this.removeSongInfoById(t)}async removeSongInfoById(e){const t=await this.getSongInfoStorage();t!==null&&(delete t[e],await this.saveSongInfoToStorage(t))}static applyLoadedInfo(e,t){e.processed={...e.processed,...t}}static getSongId(e){const t=e.getUniqueId();return t||$.makeSongId(e,Z.BASE_FIELDS)}static makeSongId(e,t){let r="";for(const a of t)e.parsed[a]&&(r+=e.parsed[a]);if(r)return ws(r);throw new Error("Empty song")}}class ja extends ${songInfoStorage=T(ae);init(){this._init(J(ae))}async clear(){return await this.songInfoStorage.clear()}async getSongInfoStorage(){return this.songInfoStorage.get()}async saveSongInfoToStorage(e){return await this.songInfoStorage.set(e)}getStorage(){return T(ae)}}const Ee=new ja;async function Sa(s){let e=!1;try{e=await Ee.loadSongInfo(s)}catch(t){w(t,"error")}s.flags.isCorrectedByUser=e}const Aa=Object.freeze(Object.defineProperty({__proto__:null,process:Sa},Symbol.toStringTag,{value:"Module"}));function ka(s){for(const e of Z.PROCESSED_FIELDS)s.processed[e]=s.parsed[e]}const va=Object.freeze(Object.defineProperty({__proto__:null,process:ka},Symbol.toStringTag,{value:"Module"})),Ra=["duration","artist","track"],Ta=["trackArtUrl","artistUrl","trackUrl","albumUrl","userPlayCount","albumMbId"];async function Ea(s,e){if(s.isEmpty())return;const t=await v({type:"getSongInfo",payload:{song:s.getCloneableData()}}),r=Ca(t),a=r!==null;if(a){if(!s.flags.isCorrectedByUser)for(const h of Ra)r[h]&&(s.processed[h]=r[h]);await Ia(s)&&(s.processed.album=r.album,s.noRegex.album=r.album,s.flags.isAlbumFetched=!0);for(const h of Ta)s.metadata[h]=r[h]}const i=await z(ve,e.id),n=await z(Re,e.id);s.flags.isValid=(a||!!i)&&(s.flags.isCorrectedByUser||!n)}async function Ia(s){return s.getAlbum()&&!s.flags.isAlbumFetched||await z(tt)?!1:await z(st)?!0:!s.flags.isCorrectedByUser}function Ca(s){return s.length===0?null:s.reduce((e,t)=>t&&(!e||js(t)>js(e))?t:e,{})}function js(s){let e=0;if(s===null)return 0;for(const t in s)s[t]&&++e;return e}const xa=Object.freeze(Object.defineProperty({__proto__:null,process:Ea},Symbol.toStringTag,{value:"Module"}));function Pa(s){for(const e of Z.BASE_FIELDS){const t=s.processed[e];typeof t=="string"&&t&&(s.processed[e]=t.normalize(),s.noRegex[e]=t.normalize())}}const La=Object.freeze(Object.defineProperty({__proto__:null,process:Pa},Symbol.toStringTag,{value:"Module"})),it=s=>({isGlobal:s.isGlobal,isCaseInsensitive:s.isCaseInsensitive,isRegexDisabled:s.isRegexDisabled}),Ss=s=>s.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");function As(s){let e="";return s.isGlobal&&(e+="g"),s.isCaseInsensitive&&(e+="i"),e}function Oa(s,e){for(const[t,r]of Object.entries(s)){const a=t;if(r!==null&&e.flags.isRegexEditedByUser[a])return!0}return!1}function Ua(s,e){if(Oa(s.replace,e))return!1;const t=it(s);for(const[r,a]of Object.entries(s.search)){const n=ne(e,r);if(!ks(a,n,t))return!1}return!0}function ks(s,e,t){if(s===null)return!0;const r=t.isRegexDisabled?Ss(s):s;try{return new RegExp(t.isGlobal?r:`^${r}$`,As(t)).test(e)}catch{return!1}}function Ma(s,e,t,r){if(s===null||e===null)return t;const a=r.isRegexDisabled?Ss(s):s;try{const i=new RegExp(r.isGlobal?a:`^${a}$`,As(r));return t.replace(i,e)}catch{return t}}function _a(s,e){const t=it(s);for(const r of Object.keys(e)){const a=r;if(!ks(s.search[a],e[a],t))return e}for(const r of Object.keys(e)){const a=r;e[a]=Ma(s.search[a],s.replace[a],e[a],it(s))}return e}function Da(s){return{track:ne(s,"track"),artist:ne(s,"artist"),album:ne(s,"album"),albumArtist:ne(s,"albumArtist")}}function Fa(s,e){const t=_a(s,Da(e));for(const[r,a]of Object.entries(t)){const i=r;s.search[i]&&typeof s.replace[i]=="string"&&(e.flags.isRegexEditedByUser[i]=!0,e.processed[i]=a)}}function Na(s){return s.charAt(0).toUpperCase()+s.slice(1)}function ne(s,e){return s[`get${Na(e)}`]()??""}class Ba extends at{async loadSongInfo(e){const t=await this.getRegexEditStorage();if(t)for(let r=t.length-1;r>=0;r--)Ua(t[r],e)&&Fa(t[r],e)}async saveRegexEdit(e){e.search={...e.search},e.replace={...e.replace};const t=await this.getRegexEditStorage();if(t===null){await this.saveRegexEditToStorage([e]);return}const r=[...t,e];await this.saveRegexEditToStorage(r)}async deleteRegexEdit(e){const t=await this.getRegexEditStorage();t!==null&&(t.splice(e,1),await this.saveRegexEditToStorage(t))}}class za extends Ba{regexEditStorage=this.getStorage();init(){this._init(J(ye))}async getRegexEditStorage(){return this.regexEditStorage.get()}async saveRegexEditToStorage(e){return await this.regexEditStorage.set(e)}getStorage(){return T(ye)}}const vs=new za;async function $a(s){if(!s.flags.isCorrectedByUser)try{await vs.loadSongInfo(s)}catch(e){w(e,"error")}}const Rs=Object.freeze(Object.defineProperty({__proto__:null,process:$a},Symbol.toStringTag,{value:"Module"})),Ts=5e3;async function qa(s){if(s.parsed.trackArt){w("Using local/parsed artwork");return}else if(s.metadata.trackArtUrl){w("Found album artwork via LastFM");return}else if(s.isEmpty())return;const e=["release","release-group"];for(const t of e){let r=s.metadata.albumMbId,a=null;try{r||(r=await Ha(t,s)),a=await Va(r)}catch{continue}if(a){w("Found album artwork via MusicBrainz"),s.metadata.trackArtUrl=a;return}}}async function Ha(s,e){const t=e.getArtist(),r=e.getTrack();if(t===null||r===null)throw new TypeError("artist or track is null");const a=`https://musicbrainz.org/ws/2/${s}?fmt=json&query=title:+"${r??""}"^3 ${r??""} artistname:+"${t??""}"^4${t??""}`,i=await _(Ts,fetch(a));if(!i.ok)throw new Error("Unable to fetch MusicBrainz ID");const n=await i.json();if(n.count===0)throw new Error("Unable to fetch MusicBrainz ID");return"releases"in n?n.releases[0].id:"release-groups"in n?n["release-groups"][0].id:""}async function Va(s){const e=`https://coverartarchive.org/release/${s}/front-500`;if((await _(Ts,fetch(e,{method:"HEAD"}))).ok)return e;throw new Error("Unable to fetch cover art from MusicBrainz")}const Ga=Object.freeze(Object.defineProperty({__proto__:null,process:qa},Symbol.toStringTag,{value:"Module"}));let Ka=class{storage=T(Ke);isReady;constructor(){this.isReady=this.init()}async setupDefaultBlocklist(){let e=await this.storage.getLocking();e||(e={}),await this.storage.setLocking(e)}async init(){return await this.setupDefaultBlocklist(),!0}async addToBlocklist(e,t){if(!t)return;await this.isReady;const r=await this.storage.getLocking(),a=t.getArtist(),i=t.getTrack();if(!r||!a||!i){this.storage.unlock();return}switch(r[a]||(r[a]={tracks:{},albums:{}}),e){case"artist":{r[a].disabled=!0;break}case"album":{const n=t.getAlbum(),h=t.getAlbumArtist()||a;if(!n){this.storage.unlock();return}r[h]||(r[h]={tracks:{},albums:{}}),r[h].albums[n]=!0;break}case"track":{r[a].tracks[i]=!0;break}}await this.storage.setLocking(r)}async removeFromBlocklist(e,t){if(!t)return;const r=t.getArtist(),a=t.getTrack();if(!r||!a)return;const i=await this.storage.getLocking();if(!i){this.storage.unlock();return}switch(e){case"artist":{delete i[r]?.disabled;break}case"album":{const n=t.getAlbumArtist()||r,h=t.getAlbum();if(!h)return;delete i[n]?.albums[h];break}case"track":{delete i[r]?.tracks[a];break}}await this.storage.setLocking(i)}async getBlockedTypes(e){const t={artist:!1,album:!1,track:!1};if(!e)return t;await this.isReady;const r=await this.storage.get(),a=e.getArtist(),i=e.getTrack();if(!r||!a||!r[a]||!i)return t;r[a].disabled&&(t.artist=!0),r[a].tracks[i]&&(t.track=!0);const n=e.getAlbumArtist()||a,h=e.getAlbum();return!h||!r[n]?.albums[h]||(t.album=!0),t}async hasBlockedTag(e){const t=await this.getBlockedTypes(e);return t.artist||t.album||t.track}};async function Wa(s){const e=new Ka;try{s.flags.hasBlockedTag=await e.hasBlockedTag(s)}catch(t){w(t,"error")}}const Ja=Object.freeze(Object.defineProperty({__proto__:null,process:Wa},Symbol.toStringTag,{value:"Module"}));class Ya{song=null;processors=[va,La,Aa,Rs,xa,Rs,Ja,Ga];constructor(){this.song=null}async process(e,t){this.song=e,this.song.flags.finishedProcessing=!1;try{for(const r of this.processors)await r.process(e,t);this.song.flags.finishedProcessing=!0}catch(r){throw this.song.flags.finishedProcessing=!0,r}return e.equals(this.song)}}const Es="ControllerReset",ot="SongNowPlaying",Is="SongUnrecognized";class Qa extends at{MAX_SCROBBLE_CACHE_SIZE=1e3;async replaceScrobble(e,t){const r=await this.getScrobbleCacheStorageLocking();if(r){for(let a=0;a<r.length;a++)r[a].id===e&&(r[a]={...t,id:e});await this.saveScrobbleCacheToStorageLocking(r)}}async pushScrobble(e){const t=await this.getScrobbleCacheStorageLocking();if(t===null)return await this.saveScrobbleCacheToStorageLocking([{...e,id:1}]),1;const r=(t.at(-1)?.id??0)+1;return t.push({...e,id:r}),await this.saveScrobbleCacheToStorageLocking(t.slice(-this.MAX_SCROBBLE_CACHE_SIZE)),r}async deleteScrobbles(e){const t=await this.getScrobbleCacheStorageLocking();if(!t)return;const r=new Map;for(const a of e)r.set(a,!0);await this.saveScrobbleCacheToStorageLocking(t.filter(a=>r.get(a.id)!==!0))}}class Za extends Qa{scrobbleCacheStorage=this.getStorage();init(){this._init(J(we))}async getScrobbleCacheStorage(){return this.scrobbleCacheStorage.get()}async getScrobbleCacheStorageLocking(){return this.scrobbleCacheStorage.getLocking()}async saveScrobbleCacheToStorage(e){return await this.scrobbleCacheStorage.set(e)}async saveScrobbleCacheToStorageLocking(e){return await this.scrobbleCacheStorage.setLocking(e)}getStorage(){return T(we)}}const Ie=new Za;class Xa{storage=T(We);connectorId;isReady;constructor(e){this.connectorId=e,this.isReady=this.init()}async setupDefaultBlocklist(){let e=await this.storage.getLocking();e||(e={}),(!(this.connectorId in e)||!e[this.connectorId])&&(e[this.connectorId]={}),await this.storage.setLocking(e)}async init(){return await this.setupDefaultBlocklist(),!0}async addToBlocklist(e){if(!e?.id)return;await this.isReady;const t=await this.storage.getLocking();if(!t||!(this.connectorId in t)||!t[this.connectorId]){this.storage.unlock();return}t[this.connectorId]={...t[this.connectorId],[e.id]:e.label||e.id},await this.storage.setLocking(t)}async removeFromBlocklist(e){if(!e)return;await this.isReady;const t=await this.storage.getLocking();if(!t||!(this.connectorId in t)||!t[this.connectorId]){this.storage.unlock();return}delete t[this.connectorId][e],this.storage.setLocking(t)}async getChannelLabel(e){if(!e)return null;await this.isReady;const t=await this.storage.get();return!t||!(this.connectorId in t)||!t[this.connectorId]?null:t[this.connectorId][e]}async shouldScrobbleChannel(e){return!await this.getChannelLabel(e)}}const ei=["artist","track","album","uniqueID"],Cs=T(pe);class ti{connector;isEnabled;mode;tempMode;timeoutId=void 0;pipeline=new Ya;playbackTimer=new ps;replayDetectionTimer=new ps;currentSong=null;isReplayingSong=!1;shouldScrobblePodcasts=!0;scrobbleCacheId=null;blocklist;isPaused=!1;forceScrobble=!1;shouldHaveScrobbled=!1;isEditing=!1;setNotEditingTimeout=setTimeout(()=>{},0);eventEmitter=new yt;tabId=v({type:"getTabId",payload:void 0});async shouldScrobble(){return this.forceScrobble?!0:!this.currentSong||this.currentSong.parsed.scrobblingDisallowedReason?!1:await this.blocklist.shouldScrobbleChannel(this.connector.getChannelId?.())?this.currentSong?.flags.hasBlockedTag?(this.currentSong.parsed.scrobblingDisallowedReason="ForbiddenTag",!1):!0:(this.currentSong.parsed.scrobblingDisallowedReason="ForbiddenChannel",!1)}async getInfoBoxElement(){if(!this.connector.scrobbleInfoLocationSelector||!await z(Se,this.connector.meta.id))return null;const e=document.querySelector(this.connector.scrobbleInfoLocationSelector);if(!e)return null;let t=document.querySelector("#scrobbler-infobox-el");if(t)if(t.parentElement!==e)t.remove();else return t;t=document.createElement("div"),t.setAttribute("id","scrobbler-infobox-el");for(const r in this.connector.scrobbleInfoStyle)t.style[r]=this.connector.scrobbleInfoStyle[r]??"";return e.appendChild(t),t}async updateInfoBox(){let e=!1;const t=await this.getInfoBoxElement();if(!t){const n=document.querySelector("#scrobbler-infobox-el");n&&n.remove();return}const r=t.querySelector("span");r&&(e=r.innerText);const a=this.getMode(),i=Util.getInfoBoxText(a,this.currentSong);if(!e||i!==e){const n=document.createElement("img");n.setAttribute("src",I.runtime.getURL("./icons/icon_main_48.png")),n.setAttribute("alt","Web Scrobbler state:"),n.setAttribute("style","height: 1.2em");const h=document.createElement("span");for(h.innerText=i;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(n),t.appendChild(h)}}constructor(e,t){this.connector=e,this.blocklist=new Xa(this.connector.meta.id),this.isEnabled=t,this.mode=t?me:jt,this.onModeChanged(),this.tempMode=null,z(Ae,e.meta.id).then(r=>{typeof r=="boolean"&&(this.shouldScrobblePodcasts=r)}).catch(r=>{w(r,"error")}),this.debugLog(`Created controller for ${e.meta.label} connector`),sr(C({type:"skipCurrentSong",fn:()=>{this.skipCurrentSong()}}),C({type:"toggleLove",fn:({isLoved:r,shouldShowNotification:a})=>{this.toggleLove(r,a)}}),C({type:"updateLove",fn:({isLoved:r})=>{this.currentSong?.setLoveStatus(r,!0)}}),C({type:"reprocessSong",fn:()=>{this.reprocessSong()}}),C({type:"setEditState",fn:r=>{this.isEditing=r,this.eventEmitter.emit("updateEditStatus",r),r&&(clearTimeout(this.setNotEditingTimeout),this.setNotEditingTimeout=setTimeout(()=>{this.isEditing=!1,this.eventEmitter.emit("updateEditStatus",!1)},5e3))}}),C({type:"resetData",fn:()=>{this.resetSongData()}}),C({type:"setConnectorState",fn:r=>{this.setConnectorState(r)}}),C({type:"disableConnectorUntilTabIsClosed",fn:()=>this.disableUntilTabIsClosed()}),C({type:"getConnectorDetails",fn:()=>({mode:this.getMode(),permanentMode:this.mode,song:this.currentSong?.getCloneableData()??null})}),C({type:"forceScrobbleSong",fn:()=>{this.forceScrobble=!0,this.shouldHaveScrobbled?this.scrobbleSong():this.setSongNowPlaying()}}),C({type:"getChannelDetails",fn:()=>({connector:this.connector.meta,channelInfo:this.connector.getChannelInfo?.()})}),C({type:"addToBlocklist",fn:async()=>{await this.blocklist.addToBlocklist(this.connector.getChannelInfo?.()??null),this.setMode(K)}}),C({type:"removeFromBlocklist",fn:async()=>{await this.blocklist.removeFromBlocklist(this.connector.getChannelInfo?.()?.id??null),this.shouldHaveScrobbled?this.scrobbleSong():this.setSongNowPlaying()}}))}onSongUpdated(){this.updateInfoBox(),v({type:"songUpdate",payload:this.currentSong?.getCloneableData()??null})}onModeChanged(){this.updateInfoBox(),v({type:"controllerModeChange",payload:{mode:this.getMode(),permanentMode:this.mode}})}async onControllerEvent(e){switch(e){case ot:{const t=this.getCurrentSong();if(!t||t.flags.isReplaying||!await this.shouldScrobble()||!this.currentSong?.isValid()||!await this.tabId)break;v({type:"showNowPlaying",payload:{song:t.getCloneableData(),connector:this.connector.meta}});break}case Es:{const t=this.getCurrentSong();t&&v({type:"clearNowPlaying",payload:{song:t.getCloneableData()}});break}case Is:{const t=this.getCurrentSong();if(!t||!await this.shouldScrobble()||!await this.tabId)break;v({type:"showSongNotRecognized",payload:{song:t.getCloneableData(),connector:this.connector.meta}});break}}this.updateInfoBox()}setEnabled(e){this.isEnabled=e,e?this.setMode(me):(this.resetState(),this.setMode(jt))}finish(){this.debugLog(`Remove controller for ${this.connector.meta.label} connector`),this.resetState()}async resetSongData(){this.assertSongIsPlaying(),this.currentSong?.resetInfo(),await Ee.removeSongInfo(this.currentSong),this.unprocessSong(),this.processSong()}skipCurrentSong(){this.assertSongIsPlaying(),E(this.currentSong)&&(this.setMode(Xs),this.currentSong.flags.isSkipped=!0,this.shouldHaveScrobbled=!1,this.forceScrobble=!1,this.playbackTimer.reset(),this.replayDetectionTimer.reset(),this.onSongUpdated())}getConnector(){return this.connector.meta}getCurrentSong(){return this.currentSong}getMode(){const e=[De,Fe];return this.tempMode!==null?this.tempMode:e.includes(this.mode)&&this.isPaused?Zs:this.mode}async setUserSongData(e){if(this.assertSongIsPlaying(),!!E(this.currentSong)){if(this.currentSong.flags.isScrobbled)throw new Error("Unable to set user data for scrobbled song");await Ee.saveSongInfo(this.currentSong,e),this.unprocessSong(),this.processSong()}}reprocessSong(){this.assertSongIsPlaying(),E(this.currentSong)&&(this.unprocessSong(),this.processSong())}async toggleLove(e,t){if(this.assertSongIsPlaying(),!!E(this.currentSong)){if(!this.currentSong.isValid())throw new Error("No valid song is now playing");this.currentSong.setLoveStatus(e,!0),this.onSongUpdated();try{e?this.setTempMode(er):this.setTempMode(tr),await v({type:"toggleLove",payload:{song:this.currentSong.getCloneableData(),isLoved:e,shouldShowNotification:t}})}catch{this.currentSong.setLoveStatus(!e,!0)}this.onSongUpdated()}}async onLoveChanged(e){if(!(!this.currentSong||![De,Fe].includes(this.mode))){if(this.currentSong.flags.isLovedInService===null){this.currentSong.flags.isLovedInService=e;return}if(e===null){this.currentSong.flags.isLovedInService=null;return}if(this.currentSong.flags.isLovedInService!==e&&(this.currentSong.flags.isLovedInService=e,await z(ke,this.connector.meta.id))){if(this.currentSong.metadata.userloved===!0&&e||this.currentSong.metadata.userloved===!1&&!e)return;this.toggleLove(e,!0)}}}onStateChanged(e){if(!this.isEnabled)return;if(si(e)){this.currentSong&&(this.debugLog("Received empty state - resetting"),this.reset()),e.isPlaying&&this.debugLog(`State from connector doesn't contain enough information about the playing track: ${xs(e)}`,"warn");return}this.isSongChanged(e)||this.isReplayingSong?e.isPlaying?this.processNewState(e):this.reset():this.processCurrentState(e)}setMode(e){if(!e)throw new Error(`Unknown mode: ${e}`);this.mode=e,this.onModeChanged()}isTempIconVisible(){return this.timeoutId!==void 0}setTempMode(e){this.isTempIconVisible()&&(clearTimeout(this.timeoutId),this.timeoutId=void 0);const t=5e3;this.tempMode=e,this.onModeChanged(),this.timeoutId=setTimeout(()=>{this.timeoutId=void 0,this.tempMode=null,this.onModeChanged()},t)}dispatchEvent(e){if(!e)throw new Error(`Unknown event: ${e}`);this.onControllerEvent(e)}processNewState(e){if(this.isPaused=!1,this.resetState(),this.currentSong=new Z(e,this.connector.meta),this.currentSong.flags.isReplaying=this.isReplayingSong,this.debugLog(`New song detected: ${xs(e)}`),!this.shouldScrobblePodcasts&&e.isPodcast){this.skipCurrentSong();return}this.playbackTimer.start(()=>{this.scrobbleSong()}),this.replayDetectionTimer.start(()=>{this.debugLog("Replaying song..."),this.isReplayingSong=!0}),e.isPlaying||this.setPaused(),this.processSong(),this.isReplayingSong=!1}async processCurrentState(e){if(!E(this.currentSong)||this.currentSong.flags.isSkipped)return;const{currentTime:t,isPlaying:r,trackArt:a,duration:i,scrobblingDisallowedReason:n}=e,h=this.currentSong.parsed.isPlaying!==r;this.currentSong.parsed.currentTime=t,this.currentSong.parsed.isPlaying=r,this.currentSong.parsed.trackArt=a,this.currentSong.parsed.scrobblingDisallowedReason=n,this.isNeedToUpdateDuration(e)&&i&&this.updateSongDuration(i),h&&r!==void 0?this.onPlayingStateChanged(r):this.mode===K&&await this.shouldScrobble()&&r&&this.setSongNowPlaying()}resetState(){this.dispatchEvent(Es),this.playbackTimer.reset(),this.replayDetectionTimer.reset(),this.shouldHaveScrobbled=!1,this.forceScrobble=!1,this.currentSong=null}async processSong(){E(this.currentSong)&&(this.shouldHaveScrobbled=!1,this.forceScrobble=!1,await this.shouldScrobble()?this.setMode(St):this.setMode(K),await this.pipeline.process(this.currentSong,this.connector.meta)&&(this.debugLog(`Song finished processing: ${this.currentSong.toString()}`),this.currentSong.flags.isMarkedAsPlaying=!1,await this.updateTimers(this.currentSong.getDuration()),this.currentSong.isValid()?await this.shouldScrobble()?this.currentSong.parsed.isPlaying?await this.shouldScrobble()?this.currentSong.parsed.isPlaying?this.playbackTimer.isExpired()?this.dispatchEvent(ot):this.setSongNowPlaying():this.setMode(me):this.setMode(K):this.setSongNotRecognized():this.setMode(K):this.setSongNotRecognized(),this.onSongUpdated()))}unprocessSong(){E(this.currentSong)&&(this.debugLog(`Song unprocessed: ${this.currentSong.toString()}`),this.debugLog("Clearing playback timer destination time"),this.currentSong.resetData(),this.shouldHaveScrobbled=!1,this.forceScrobble=!1,this.playbackTimer.update(null),this.replayDetectionTimer.update(null))}async onPlayingStateChanged(e){if(this.debugLog(`isPlaying state changed to ${String(e)}`),e&&this.currentSong){this.setResumedPlaying(),this.playbackTimer.resume(),this.replayDetectionTimer.resume();const{isMarkedAsPlaying:t}=this.currentSong.flags;!t&&this.currentSong.isValid()&&await this.shouldScrobble()?this.setSongNowPlaying():this.onModeChanged()}else this.setPaused()}isSongChanged(e){if(!E(this.currentSong))return!0;for(const t of ei)if(t in e&&t in this.currentSong.parsed&&e[t]!==this.currentSong.parsed[t])return!0;return!1}isNeedToUpdateDuration(e){return!!e.duration&&this.currentSong?.parsed.duration!==e.duration}updateSongDuration(e){E(this.currentSong)&&(this.debugLog(`Update duration: ${e}`),this.currentSong.parsed.duration=e,this.updateTimers(e))}async updateTimers(e){if(this.playbackTimer.isExpired()){this.debugLog("Attempt to update expired timers","warn");return}const t=await z(et,this.connector.meta.id),r=Hs(t),a=Vs(e,r);if(a!==-1){this.playbackTimer.update(a),this.replayDetectionTimer.update(e);const i=this.playbackTimer.getRemainingSeconds();this.debugLog(`The song will be scrobbled in ${i??-999} seconds`),this.debugLog(`The song will be repeated in ${e} seconds`)}else this.debugLog("The song is too short to scrobble")}async setSongNowPlaying(){if(!E(this.currentSong)||!this.currentSong.isValid()||!await this.shouldScrobble())return;if(!this.currentSong.flags.finishedProcessing){this.debugLog("Song set as loading"),this.setMode(St);return}this.currentSong.flags.isMarkedAsPlaying=!0;const e=await v({type:"setNowPlaying",payload:{song:this.currentSong.getCloneableData()}});pt(e,f.RESULT_OK)?(this.debugLog("Song set as now playing"),this.setMode(De)):(this.debugLog("Song isn't set as now playing"),this.setMode(_e)),this.dispatchEvent(ot)}async setPaused(){this.playbackTimer.pause(),this.replayDetectionTimer.pause(),!(!E(this.currentSong)||!this.currentSong.isValid()||!await this.shouldScrobble())&&(this.isPaused=!0,this.onModeChanged(),await v({type:"setPaused",payload:{song:this.currentSong.getCloneableData()}}))}async setResumedPlaying(){this.isPaused=!1,!(!E(this.currentSong)||!this.currentSong.isValid()||!await this.shouldScrobble())&&(this.onModeChanged(),await v({type:"setResumedPlaying",payload:{song:this.currentSong.getCloneableData()}}))}setSongNotRecognized(){this.setMode(At),this.dispatchEvent(Is)}setConnectorState(e){this.setEnabled(e),bs(this.getConnector(),e)}async disableUntilTabIsClosed(){const e=await Cs.get(),t=await this.tabId;Cs.set({...e,[t??-1]:{...e?.[t??-1]??{},[this.connector.meta.id]:!0}}),this.setEnabled(!1)}async saveFailedScrobble(){return E(this.currentSong)?await this.shouldScrobble()?this.currentSong.isValid()?!1:(this.scrobbleCacheId=await Ie.pushScrobble({song:this.currentSong.getCloneableData(),status:qe.INVALID}),this.shouldHaveScrobbled=!0,!0):(this.scrobbleCacheId=await Ie.pushScrobble({song:this.currentSong.getCloneableData(),status:qe.DISALLOWED}),this.shouldHaveScrobbled=!0,!0):!0}async scrobbleSong(){if(!E(this.currentSong)||await this.saveFailedScrobble())return;this.scrobbleCacheId&&(Ie.deleteScrobbles([this.scrobbleCacheId]),this.scrobbleCacheId=null),this.isEditing&&await new Promise(t=>{const r=a=>{a||(this.eventEmitter.off("updateEditStatus",r),t(!0))};this.eventEmitter.on("updateEditStatus",r)});const e=await v({type:"scrobble",payload:{songs:[this.currentSong.getCloneableData()],currentlyPlaying:!0}});pt(e[0],f.RESULT_OK)?(this.debugLog("Scrobbled successfully"),this.currentSong.flags.isScrobbled=!0,this.setMode(Fe),this.onSongUpdated()):Ks(e[0],f.RESULT_IGNORE)?(this.debugLog("Song is ignored by service"),this.setMode(Qs)):(this.debugLog("Scrobbling failed","warn"),this.setMode(_e))}reset(){this.resetState(),this.setMode(me)}assertSongIsPlaying(){if(!this.currentSong)throw new Error("No song is now playing")}debugLog(e,t="log"){const r=`Controller: ${e}`;w(r,t)}}function si(s){return!(s.artist&&s.track)&&!s.uniqueID&&!s.duration}function xs(s){return JSON.stringify(s,null,2)}function E(s){return!!s}function ri(){if(window.STARTER_LOADED){w("Starter is already loaded","warn");return}if(ai()){w("You have overwritten or unset the Connector object","warn");return}ii()}function ai(){return typeof Connector>"u"||!(Connector instanceof ls)}async function ii(){const e=await T(be).get(),r=await T(pe).get(),a=await v({type:"getTabId",payload:void 0});if(oi(!r?.[a??-2]?.[Connector.meta.id]&&(e===null||!e[L][Connector.meta.id])),Connector.playerSelector===null){w("`Connector.playerSelector` is empty. The current connector is expected to manually detect state changes","info");return}w("Setting up observer");const i=Ls();i!==null?Ps(i):(w(`Element '${Connector.playerSelector.toString()}' is missing`,"warn"),ni())}function oi(s){const e=new ti(Connector,s);Connector.controllerCallback=e.onStateChanged.bind(e),Connector.isLovedCallback=e.onLoveChanged.bind(e)}function Ps(s){const e=new MutationObserver(Connector.onStateChanged),t={childList:!0,subtree:!0,attributes:!0,characterData:!0};e.observe(s,t),w(`Used '${Connector.playerSelector?.toString()??"errorPlayerSelectorNotDefined"}' to watch changes.`)}function ni(){const s=new MutationObserver(()=>{const t=Ls();t!==null&&(s.disconnect(),Ps(t))}),e={childList:!0,subtree:!0,attributes:!1,characterData:!1};s.observe(document,e)}function Ls(){if(Connector.playerSelector===null)return null;if(typeof Connector.playerSelector=="object"){for(const s of Connector.playerSelector){const e=document.querySelector(s);if(e!==null)return e}return null}return document.querySelector(Connector.playerSelector)}class le{storage;userApiUrl=null;userToken=null;arrayProperties=null;constructor(){this.storage=this.initStorage(),this.initUserProps(),ir(ar({type:"updateScrobblerProperties",fn:()=>{this.initUserProps()}}))}async getUserProperties(){const e=await this.storage.get();return!e||!("properties"in e)||!e.properties?{}:e.properties}async applyUserProperties(e){this.applyProps(e,this.getUserDefinedProperties());let t=await this.storage.get();if(t||(t={}),!t){M("No data in storage","error");return}if((!("properties"in t)||t.properties===void 0)&&(t.properties={}),!("properties"in t)||t.properties===void 0){M("No properties in storage","error");return}for(const r in e){const a=e[r];a?t.properties[r]=a:r in t.properties&&delete t.properties[r]}await this.storage.set(t)}getUserDefinedProperties(){return[]}getUserDefinedArrayProperties(){return[]}async getArrayProperties(){const e=await this.storage.get();return!e||!("arrayProperties"in e)||!e.arrayProperties?[]:e.arrayProperties}async addUserArrayProperties(e){let t=await this.storage.get();if((!t||!("arrayProperties"in t)||!t.arrayProperties)&&(t={arrayProperties:[]}),!t||!("arrayProperties"in t)||!t.arrayProperties){M("No data in storage","error");return}t.arrayProperties.push(e),this.applyArrayProps(t.arrayProperties,this.getUserDefinedArrayProperties()),await this.storage.set(t)}async applyUserArrayProperties(e){let t=await this.storage.get();if((!t||!("arrayProperties"in t)||!t.arrayProperties)&&(t={arrayProperties:[]}),!t||!("arrayProperties"in t)||!t.arrayProperties){M("No data in storage","error");return}t.arrayProperties=e,this.applyArrayProps(t.arrayProperties,this.getUserDefinedArrayProperties()),await this.storage.set(t)}async signOut(){const e=await this.storage.get();if(!e){M("No data in storage","error");return}"sessionID"in e&&delete e.sessionID,"sessionName"in e&&delete e.sessionName,"arrayProperties"in e&&delete e.arrayProperties,await this.storage.set(e)}async getProfileUrl(){const{sessionName:e}=await this.getSession();return`${this.getBaseProfileUrl()}${e??"undefined"}`}canLoveSong(){return!1}canLoadSongInfo(){return!1}applyFilter(e){return e}get REQUEST_TIMEOUT(){return 15e3}debugLog(e,t="log"){const r=`${this.getLabel()}: ${e}`;M(r,t)}initStorage(){const e=["token","sessionID","sessionName"];e.push(...this.getUserDefinedProperties());const t=Wt(this.getStorageName());return t.debugLog(e),t}async initUserProps(){const e=await this.storage.get();if(e&&"properties"in e)for(const t in e.properties)t==="userApiUrl"&&"userApiUrl"in e.properties&&(this.userApiUrl=e.properties.userApiUrl),t==="userToken"&&"userToken"in e.properties&&(this.userToken=e.properties.userToken);e&&"arrayProperties"in e&&(this.arrayProperties=e.arrayProperties??[])}applyProps(e,t){for(const r in e){if(!t.includes(r))throw new Error(`Unknown property: ${r}`);const a=e[r];if(a===void 0)throw new Error(`Property is not set: ${r}`);a&&r in this?this[r]=e[r]:r in this&&delete this[r]}}applyArrayProps(e,t){if(!e)throw new Error("No props passed to applyArrayProps()");if(e.length===0){this.arrayProperties=[];return}for(const r of e)for(const[a,i]of Object.entries(r)){if(!t.includes(a))throw new Error(`Unknown property: ${a}`);if(i===void 0)throw new Error(`Property is not set: ${a}`)}this.arrayProperties=e}}class Os extends le{isLocalOnly=!1;async getAuthUrl(){const e={method:"auth.gettoken"};let t=null,r=await this.storage?.get();try{t=(await this.sendRequest({method:"GET"},e,!1)).token}catch{throw this.debugLog("Error acquiring a token","warn"),new Error("Error acquiring a token")}return r||(r={token:t}),r.token=t,"sessionID"in r&&delete r.sessionID,"sessionName"in r&&delete r.sessionName,await this.storage.set(r),`${this.getBaseAuthUrl()}?api_key=${this.getApiKey()}&token=${t||""}`}async getSession(){const e=await this.storage.get();if(!e)throw new Error(f.ERROR_AUTH);if(!("token"in e)){if(!("sessionID"in e))throw new Error(f.ERROR_AUTH);return{sessionID:e.sessionID??"undefined",sessionName:e.sessionName}}const t=e.token||null;if(t!==null)try{const r=await this.tradeTokenForSession(t);return delete e.token,e.sessionID=r.sessionID,e.sessionName=r.sessionName,await this.storage.set(e),r}catch{throw this.debugLog("Failed to trade token for session","warn"),await this.signOut(),new Error(f.ERROR_AUTH)}return{sessionID:e.sessionID,sessionName:e.sessionName}}async isReadyForGrantAccess(){const e=await this.storage.get();return!e||!("token"in e)?!1:!!e.token}async sendNowPlaying(e){const{sessionID:t}=await this.getSession(),r={method:"track.updatenowplaying",track:e.getTrack(),artist:e.getArtist(),sk:t};e.getAlbum()&&(r.album=e.getAlbum()),e.getAlbumArtist()&&(r.albumArtist=e.getAlbumArtist()),e.getDuration()&&(r.duration=`${e.getDuration()??""}`);const a=await this.sendRequest({method:"POST"},r);return this.processResponse(a)}async sendPaused(){return Promise.resolve(f.RESULT_OK)}async sendResumedPlaying(){return Promise.resolve(f.RESULT_OK)}async scrobble(e){const{sessionID:t}=await this.getSession(),r={method:"track.scrobble",sk:t};for(const[n,h]of e.slice(0,50).entries())r[`timestamp[${n}]`]=h.metadata.startTimestamp.toString(),r[`track[${n}]`]=h.getTrack(),r[`artist[${n}]`]=h.getArtist(),h.getAlbum()&&(r[`album[${n}]`]=h.getAlbum()),h.getAlbumArtist()&&(r[`albumArtist[${n}]`]=h.getAlbumArtist());const a=await this.sendRequest({method:"POST"},r),i=this.processResponse(a);if(i===f.RESULT_OK){const n=a.scrobbles;if(n){const h=n["@attr"].ignored;if(Number(h)===0)return new Array(Math.min(e.length,50)).fill(f.RESULT_OK);if(!Array.isArray(n.scrobble))return new Array(Math.min(e.length,50)).fill(f.RESULT_IGNORE);const y={};for(const[k,O]of e.entries())y[O.metadata.startTimestamp.toString()]=k;const A=new Array(Math.min(e.length,50));for(const k of n.scrobble)A[y[k.timestamp]]=k.ignoredMessage.code==="0"?f.RESULT_OK:f.RESULT_IGNORE}else return new Array(Math.min(e.length,50)).fill(f.ERROR_OTHER)}return new Array(Math.min(e.length,50)).fill(i)}async toggleLove(e,t){const{sessionID:r}=await this.getSession(),a={method:t?"track.love":"track.unlove",track:e.getTrack(),artist:e.getArtist(),sk:r},i=await this.sendRequest({method:"POST"},a);return this.processResponse(i)}canLoveSong(){return!0}async sendRequest(e,t,r=!0){const a=this.makeRequestUrl(t,r),i=fetch(a,e),n=this.REQUEST_TIMEOUT;let h=null,y=null;try{h=await _(n,i),y=await h.json()}catch{throw new Error(f.ERROR_OTHER)}const A=JSON.stringify(y,null,2),k=li(y,A);if(!h.ok)throw this.debugLog(`${t.method} response:
${k}`,"error"),new Error(f.ERROR_OTHER);return this.debugLog(`${t.method} response:
${k}`),y}async tradeTokenForSession(e){const t={method:"auth.getsession",token:e},r=await this.sendRequest({method:"GET"},t);if(this.processResponse(r)!==f.RESULT_OK)throw new Error(f.ERROR_AUTH);const i=r.session.name;return{sessionID:r.session.key,sessionName:i}}makeRequestUrl(e,t){e.api_key=this.getApiKey(),e.format="json",t&&(e.api_sig=this.generateSign(e));const r=wt(e);return`${this.getApiUrl()}?${r}`}generateSign(e){const t=Object.keys(e).sort();let r="";for(const a of t)["format","callback"].includes(a)||(r+=`${a}${e[a]||""}`);return ws(r+this.getApiSecret())}processResponse(e){return e.error?f.ERROR_OTHER:f.RESULT_OK}}function li(s,e){let t=e;const r=[s.token],a=s.session;a&&(r.push(a.name),r.push(a.key));for(const i of r)typeof i=="string"?t=ft(i,t):typeof i=="number"&&(t=ft(i.toString(),t));return t}class ci extends Os{getApiUrl(){return"https://ws.audioscrobbler.com/2.0/"}getApiKey(){return"d9bb1870d3269646f740544d9def2c95"}getApiSecret(){return"2160733a567d4a1a69a73fad54c564b2"}getBaseAuthUrl(){return"https://www.last.fm/api/auth/"}getBaseProfileUrl(){return"https://last.fm/user/"}getId(){return"lastfm"}getLabel(){return"Last.fm"}getStatusUrl(){return"http://status.last.fm/"}getStorageName(){return"LastFM"}async getSongInfo(e){const t={track:e.getTrack(),artist:e.getArtist(),method:"track.getinfo"};try{const{sessionName:n}=await this.getSession();t.username=n}catch{}e.getAlbum()&&(t.album=e.getAlbum());const r=await this.sendRequest({method:"GET"},t,!1);if(this.processResponse(r)!==f.RESULT_OK)throw new Error("Unable to load song info");const i=this.parseSongInfo(r);return this.canLoveSong()&&i&&rr(e.controllerTabId,{type:"updateLove",payload:{isLoved:i.userloved||!1}}),i}canLoadSongInfo(){return!0}parseSongInfo(e){const t={},r=e.track,a=e.track.album,i=e.track.artist,n=r.userloved;if(n?t.userloved=n==="1":t.userloved=void 0,t.artist=i.name,t.artistUrl=i.url,t.track=r.name,t.trackUrl=r.url,t.duration=parseInt(r.duration)/1e3||null,a&&(t.album=a.title,t.albumUrl=a.url,t.albumMbId=a.mbid,Array.isArray(a.image))){const h=a.image.reduce((A,k)=>(A[k.size]=k["#text"],A),{}),y=["extralarge","large","medium"];for(const A of y){const k=h[A];if(k){t.trackArtUrl=k;break}}}return t.userPlayCount=parseInt(r.userplaycount)||0,t}applyFilter(e){if(e.getAlbumArtist()){const t=e.getAlbumArtist()||"";e.parsed.albumArtist=t.includes("Various Artists")?"Various Artists":t}return e}}class ui extends Os{getApiUrl(){return"https://libre.fm/2.0/"}getApiKey(){return"r8i1y91hz71tcx7vyrp9hk1alhqp1898"}getApiSecret(){return"8187db5vg234yq6tm7o62q8mtl1niala"}getBaseAuthUrl(){return"https://www.libre.fm/api/auth/"}getBaseProfileUrl(){return"https://libre.fm/user/"}getLabel(){return"Libre.fm"}getStatusUrl(){return""}getStorageName(){return"LibreFM"}async getSongInfo(){return Promise.resolve({})}sendRequest(e,t,r){return e.method?.toLowerCase()==="post"&&(e.headers={"Content-Type":"application/x-www-form-urlencoded"},e.body=wt(t)),super.sendRequest(e,t,r)}}const di="https://listenbrainz.org/settings/",nt="https://api.listenbrainz.org/1",mi=`${nt}/submit-listens`;class gi extends le{isLocalOnly=!1;async getSongInfo(){return Promise.resolve({})}async getAuthUrl(){const e=await this.storage.get();let t;return e&&"properties"in e&&(t=e.properties),t?await this.storage.set({isAuthStarted:!0,properties:t}):await this.storage.set({isAuthStarted:!0}),"https://listenbrainz.org/login/musicbrainz?next=%2Fsettings%2F"}getBaseProfileUrl(){return"https://listenbrainz.org/user/"}getLabel(){return"ListenBrainz"}async getProfileUrl(){return this.userToken?"":await super.getProfileUrl()}getStatusUrl(){return this.userToken?"":"https://listenbrainz.org/current-status"}getStorageName(){return"ListenBrainz"}getUserDefinedProperties(){return["userApiUrl","userToken"]}async signOut(){(this.userApiUrl||this.userToken)&&await this.applyUserProperties({userApiUrl:null,userToken:null}),await super.signOut()}async getSession(){if(this.userToken)return{sessionID:this.userToken};const e=await this.storage.get();if(!e)throw this.debugLog("no data","error"),await this.signOut(),new Error(f.ERROR_AUTH);if("isAuthStarted"in e&&e.isAuthStarted)try{const t=await this.requestSession();return e.sessionID=t.sessionID,e.sessionName=t.sessionName,delete e.isAuthStarted,await this.storage.set(e),t}catch{throw this.debugLog("Failed to get session","warn"),await this.signOut(),new Error(f.ERROR_AUTH)}else if(!("sessionID"in e)||!e.sessionID)throw new Error(f.ERROR_AUTH);return{sessionID:e.sessionID,sessionName:e.sessionName}}async isReadyForGrantAccess(){if(this.userToken)return!1;const e=await this.storage.get();return!e||!("isAuthStarted"in e)?!1:e.isAuthStarted??!1}async sendNowPlaying(e){const{sessionID:t}=await this.getSession(),a={listen_type:"playing_now",payload:[{track_metadata:this.makeTrackMetadata(e)}]};return this.sendScrobbleRequest(a,t)}async sendPaused(){return Promise.resolve(f.RESULT_OK)}async sendResumedPlaying(){return Promise.resolve(f.RESULT_OK)}async scrobble(e,t){const{sessionID:r}=await this.getSession(),a={listen_type:t?"single":"import",payload:e.slice(0,50).map(n=>({listened_at:n.metadata.startTimestamp,track_metadata:this.makeTrackMetadata(n)}))},i=await this.sendScrobbleRequest(a,r);return new Array(Math.min(e.length,50)).fill(i)}async toggleLove(e,t){const r=e.getTrack(),a=e.getArtist();if(typeof r!="string"||typeof a!="string")throw new Error(`Invalid track ${JSON.stringify({artist:a,track:r})}`);const i=new URLSearchParams({recording_name:r,artist_name:a});let n={};try{n=await this.listenBrainzApi("GET",`${nt}/metadata/lookup?${i.toString()}`,null,null)}catch{}if(this.debugLog(`lookup result: ${JSON.stringify(n,null,2)}`),!n.recording_mbid)return this.debugLog(`Could not lookup metadata for song: ${e.toString()}`),{};const{sessionID:h}=await this.getSession(),y={recording_mbid:n.recording_mbid,score:t?1:0},A=await this.listenBrainzApi("POST",`${nt}/feedback/recording-feedback`,y,h);return this.processResult(A)}canLoveSong(){return!0}async listenBrainzApi(e,t,r,a){const i={method:e,headers:{"Content-Type":"application/json; charset=UTF-8"}};r&&(i.body=JSON.stringify(r)),a&&i.headers&&(i.headers.Authorization=`Token ${a}`);const n=fetch(t,i),h=this.REQUEST_TIMEOUT;let y=null,A=null;try{A=await _(h,n),y=await A.json()}catch{throw this.debugLog("Error while sending request","error"),new Error(f.ERROR_OTHER)}switch(A.status){case 400:throw this.debugLog("Invalid JSON sent","error"),new Error(f.ERROR_AUTH);case 401:throw this.debugLog("Invalid Authorization sent","error"),new Error(f.ERROR_AUTH)}return this.debugLog(JSON.stringify(y,null,2)),y}async sendScrobbleRequest(e,t){const r=await this.listenBrainzApi("POST",this.userApiUrl||mi,e,t);return this.processResult(r)}async requestSession(){let e=null;try{e=await this.fetchSession(di)}catch{this.debugLog("request session timeout","warn")}if(e){const t=bt(e.sessionID);return this.debugLog(`Session ID: ${t}`),e}throw new Error(f.ERROR_AUTH)}async fetchSession(e){this.debugLog(`Use ${e}`);const t=Ws()?Js(e):v({type:"sendListenBrainzRequest",payload:{url:e}}),r=this.REQUEST_TIMEOUT,a=await _(r,t);if(a!==null){let i=null;const n=a.match(/<script id="global-react-props" type="application\/json">(.*?)<\/script>/)?.[1];n&&(i=JSON.parse(n));const h=i?.current_user.name,y=i?.current_user.auth_token;if(y&&h)return{sessionID:y,sessionName:h}}return null}processResult(e){return e.status!=="ok"?f.ERROR_OTHER:f.RESULT_OK}makeTrackMetadata(e){const t={artist_name:e.getArtist()??"",track_name:e.getTrack()??"",additional_info:{submission_client:"Web Scrobbler",submission_client_version:Ys(),music_service_name:e.metadata.label}},r=e.getAlbum();r&&(t.release_name=r);const a=e.getOriginUrl();a&&(t.additional_info.origin_url=a);const i=e.getAlbumArtist();i&&(t.additional_info.release_artist_name=i),a&&e.metadata.label==="Spotify"&&(t.additional_info.spotify_id=a);const n=e.getDuration();return n&&(t.additional_info.duration=n),t}}class hi extends le{isLocalOnly=!0;getStorageName(){return"Maloja"}getLabel(){return"Maloja"}getStatusUrl(){return""}getUserDefinedProperties(){return["userApiUrl","userToken"]}async getProfileUrl(){return Promise.resolve("")}async getAuthUrl(){return Promise.resolve("")}getBaseProfileUrl(){return""}getSongInfo(){return Promise.resolve({})}toggleLove(){return Promise.resolve(f.ERROR_OTHER)}async getSession(){if(!this.userToken)throw new Error(f.ERROR_AUTH);return Promise.resolve({sessionID:this.userToken})}isReadyForGrantAccess(){return Promise.resolve(!1)}sendNowPlaying(){return Promise.resolve(f.RESULT_OK)}async sendPaused(){return Promise.resolve(f.RESULT_OK)}async sendResumedPlaying(){return Promise.resolve(f.RESULT_OK)}async scrobble(e){const t=[];for(const r of e.slice(0,50)){const a=this.makeTrackMetadata(r);t.push(this.sendRequest(a,this.userToken))}return Promise.all(t)}async sendRequest(e,t){e.key=t;const r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},a=fetch(this.userApiUrl,r),i=this.REQUEST_TIMEOUT;let n=null;try{if(n=await _(i,a),n.status!==200)return f.ERROR_OTHER}catch{return this.debugLog("Error while sending request","error"),f.ERROR_OTHER}return f.RESULT_OK}makeTrackMetadata(e){const t={artist:e.getArtist()??"",title:e.getTrack()??"",time:e.metadata.startTimestamp},r=e.getAlbum();r&&(t.album=r);const a=e.getAlbumArtist();return a&&(t.albumartists=[a]),t}}class fi extends le{isLocalOnly=!0;getBaseProfileUrl(){return""}getLabel(){return"Webhook"}getStatusUrl(){return""}getStorageName(){return"Webhook"}getSession(){return!this.arrayProperties||this.arrayProperties.length===0?Promise.reject(new Error("")):Promise.resolve({sessionID:"webhook"})}getAuthUrl(){return Promise.resolve("")}isReadyForGrantAccess(){return Promise.resolve(!1)}async getProfileUrl(){return Promise.resolve("")}getUserDefinedArrayProperties(){return["applicationName","userApiUrl"]}async getSongInfo(){return Promise.resolve({})}async sendRequest(e){if(!this.arrayProperties||this.arrayProperties.length===0)return f.ERROR_AUTH;this.debugLog(`Webhook - sendRequest: ${JSON.stringify(e,null,2)}`);const t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},r=[];for(const i of this.arrayProperties)r.push(fetch(i.userApiUrl,t));const a=this.REQUEST_TIMEOUT;try{const i=await _(a,Promise.all(r));for(const n of i)if(n.status!==200)return this.debugLog(`Error in ${n.url}.`,"error"),f.ERROR_OTHER}catch{return this.debugLog("Error while sending request","error"),f.ERROR_OTHER}return f.RESULT_OK}async sendNowPlaying(e){return this.sendRequest({eventName:"nowplaying",time:Date.now(),data:{song:e}})}async sendPaused(e){return this.sendRequest({eventName:"paused",time:Date.now(),data:{song:e}})}async sendResumedPlaying(e){return this.sendRequest({eventName:"resumedplaying",time:Date.now(),data:{song:e}})}async scrobble(e,t){const r=await this.sendRequest({eventName:"scrobble",time:Date.now(),data:{song:e[0],songs:e,currentlyPlaying:t}});return new Array(e.length).fill(r)}toggleLove(e,t){return this.sendRequest({eventName:"loved",time:Date.now(),data:{song:e,isLoved:t}})}}class bi extends le{isLocalOnly=!0;getStorageName(){return"Pleroma"}getLabel(){return"Pleroma"}getStatusUrl(){return""}getUserDefinedProperties(){return["userApiUrl","userToken"]}async getProfileUrl(){return Promise.resolve("")}async getAuthUrl(){return Promise.resolve("")}getBaseProfileUrl(){return""}getSongInfo(){return Promise.resolve({})}toggleLove(){return Promise.resolve(f.ERROR_OTHER)}async getSession(){if(!this.userToken)throw new Error(f.ERROR_AUTH);const e={method:"GET",headers:{Authorization:`Bearer ${this.userToken}`}},t=`https://${this.userApiUrl}/api/v1/accounts/verify_credentials`,r=fetch(t,e),a=this.REQUEST_TIMEOUT;let i=null;try{if(i=await _(a,r),i.status!==200)throw new Error(f.ERROR_AUTH);const n=await i.json(),h=n?n.fqn:"";return{sessionID:this.userToken,sessionName:h}}catch{throw this.debugLog("Error while sending request","error"),new Error(f.ERROR_AUTH)}}isReadyForGrantAccess(){return Promise.resolve(!1)}sendNowPlaying(){return Promise.resolve(f.RESULT_OK)}async sendResumedPlaying(){return Promise.resolve(f.RESULT_OK)}async sendPaused(){return Promise.resolve(f.RESULT_OK)}async scrobble(e){const t=[];for(const r of e.slice(0,50)){const a=this.makeTrackMetadata(r);t.push(this.sendRequest(a,this.userToken))}return Promise.all(t)}async sendRequest(e,t){const r={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)},a=`https://${this.userApiUrl}/api/v1/pleroma/scrobble`,i=fetch(a,r),n=this.REQUEST_TIMEOUT;let h=null;try{if(h=await _(n,i),h.status!==200)return f.ERROR_OTHER}catch{return this.debugLog("Error while sending request","error"),f.ERROR_OTHER}return f.RESULT_OK}makeTrackMetadata(e){const t={artist:e.getArtist()??"",title:e.getTrack()??"",length:e.getDuration(),url:e.parsed.originUrl??""},r=e.getAlbum();return r&&(t.album=r),t}}const ce=[new ci,new ui,new gi,new hi,new fi,new bi];function Us(s,e){return e.some(t=>t.getLabel()===s.getLabel())}class pi{boundScrobblers=[];async bindAllScrobblers(){for(const e of ce)try{await e.getSession(),this.bindScrobbler(e)}catch{w(`Unable to bind ${e.getLabel()}`,"warn")}return this.boundScrobblers}bindScrobbler(e){Us(e,this.boundScrobblers)||(this.boundScrobblers.push(e),w(`Bind ${e.getLabel()} scrobbler`))}unbindScrobbler(e){if(Us(e,this.boundScrobblers)){const t=this.boundScrobblers.indexOf(e);this.boundScrobblers.splice(t,1),w(`Unbind ${e.getLabel()} scrobbler`)}else w(`${e.getLabel()} is not bound`,"error")}getSongInfo(e){const t=ce.filter(r=>r.canLoadSongInfo());return w(`Send "get info" request: ${t.length}`),Promise.all(t.map(async r=>{try{return await r.getSongInfo(e)}catch{return w(`Unable to get song info from ${r.getLabel()}`,"warn"),null}}))}sendNowPlaying(e){return w(`Send "now playing" request: ${this.boundScrobblers.length}`),Promise.all(this.boundScrobblers.map(async t=>{try{return await t.sendNowPlaying(t.applyFilter(e))}catch(r){return this.processErrorResult(t,r)}}))}sendPaused(e){const t=this.boundScrobblers.filter(r=>typeof r.sendPaused=="function");return t.length===0?Promise.resolve([f.RESULT_OK]):(w(`Send "paused" request: ${t.length}`),Promise.all(t.map(async r=>{try{return await r.sendPaused(r.applyFilter(e))}catch(a){return this.processErrorResult(r,a)}})))}sendResumedPlaying(e){const t=this.boundScrobblers.filter(r=>typeof r.sendResumedPlaying=="function");return t.length===0?Promise.resolve([f.RESULT_OK]):(w(`Send "paused" request: ${t.length}`),Promise.all(t.map(async r=>{try{return await r.sendResumedPlaying(r.applyFilter(e))}catch(a){return this.processErrorResult(r,a)}})))}async scrobble(e,t){w(`Send "scrobble" request: ${this.boundScrobblers.length}`);const r=await Promise.all(this.boundScrobblers.map(async a=>{try{return await a.scrobble(e.map(a.applyFilter),t)}catch(i){return this.processScrobbleErrorResult(a,i)}}));for(let a=0;a<r[0].length;a++)await Ie.pushScrobble({song:e[a].getCloneableData(),status:Ir(r,a)});return r}async toggleLove(e,t){const r=ce.filter(i=>i.canLoveSong());return w(`Send "${t?"love":"unlove"}" request: ${r.length}`),Promise.all(r.map(async i=>{try{return await i.toggleLove(e,t)}catch(n){return this.processErrorResult(i,n)}}))}getRegisteredScrobblers(){return ce}getScrobblerByLabel(e){for(const t of ce)if(t.getLabel()===e)return t;return null}async processErrorResult(e,t){const r=t===f.ERROR_OTHER,a=t===f.ERROR_AUTH;if(!(r||a))throw new Error(`Invalid result: ${t}`);return a&&(await e.isReadyForGrantAccess()||this.unbindScrobbler(e)),t}async processScrobbleErrorResult(e,t){const r=t[0]===f.ERROR_OTHER,a=t[0]===f.ERROR_AUTH;if(!(r||a))throw new Error(`Invalid result: ${t[0]}`);return a&&(await e.isReadyForGrantAccess()||this.unbindScrobbler(e)),t}}const yi=new pi;function wi(){const s=I.runtime.getURL("connectors/webhook-auth-dom-inject.js"),e=document.createElement("script");e.src=s,e.onload=function(){const t=this;t.parentNode?.removeChild(t)},(document.head||document.documentElement).appendChild(e),window.addEventListener("message",t=>{typeof t.data=="object"&&t.data&&"sender"in t.data&&t.data.sender==="web-scrobbler"&&"type"in t.data&&t.data.type==="confirmLogin"&&"applicationName"in t.data&&typeof t.data.applicationName=="string"&&"userApiUrl"in t.data&&typeof t.data.userApiUrl=="string"&&yi.getScrobblerByLabel("Webhook")?.addUserArrayProperties({applicationName:t.data.applicationName,userApiUrl:t.data.userApiUrl}).then(()=>{v({type:"updateScrobblerProperties",payload:void 0})})})}ji();async function ji(){Ai();try{if(window.location.href.startsWith("https://webscrobbler.com/webhook")){wi();return}await Si(),ri()}catch(s){if(s instanceof Error&&s.message==="dontlog")return;w(s,"error")}}async function Si(){const s=await Or(window.location.href);if(!s)throw new Error("dontlog");if(window!==top&&!s.allFrames)throw new Error("dontlog");window.Connector=new ls(s),window.Util=Er,window.MetadataFilter=ia,window.webScrobblerScripts={},Ee.init(),vs.init();try{await import(I.runtime.getURL(`connectors/${s?.js}`)),w(`Successfully loaded ${s.label} connector`)}catch(e){throw w(`An error occured while loading ${s.label} connector`,"error"),e}}function Ai(){const s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";v({type:"updateTheme",payload:s})}})();
